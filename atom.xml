<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>左之右</title>
  
  <subtitle>SamLai&#39;Blog</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://zuoyoulai.github.io/"/>
  <updated>2020-03-17T02:32:31.941Z</updated>
  <id>https://zuoyoulai.github.io/</id>
  
  <author>
    <name>[object Object]</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>mac操作虚拟机</title>
    <link href="https://zuoyoulai.github.io/2020/03/16/mac%E6%93%8D%E4%BD%9C%E8%99%9A%E6%8B%9F%E6%9C%BA/"/>
    <id>https://zuoyoulai.github.io/2020/03/16/mac%E6%93%8D%E4%BD%9C%E8%99%9A%E6%8B%9F%E6%9C%BA/</id>
    <published>2020-03-15T16:22:09.000Z</published>
    <updated>2020-03-17T02:32:31.941Z</updated>
    
    <content type="html"><![CDATA[<h3><span id="an-zhuang-vmvare-funshion">安装 Vmvare Funshion</span><a href="#an-zhuang-vmvare-funshion" class="header-anchor"></a></h3><h3><span id="she-zhi-xu-ni-ji-de-nei-cun-yu-cun-chu">设置虚拟机的内存与存储</span><a href="#she-zhi-xu-ni-ji-de-nei-cun-yu-cun-chu" class="header-anchor"></a></h3><ul><li>进入控制台输入立即关机的操作: shutdown -h now</li></ul><h3><span id="an-zhuang-xiang-ying-de-jing-xiang">安装相应的镜像</span><a href="#an-zhuang-xiang-ying-de-jing-xiang" class="header-anchor"></a></h3><ul><li>查看的 ip 地址的设置: <a href="https://www.cnblogs.com/mmx8861/p/9217445.html" target="_blank" rel="noopener">https://www.cnblogs.com/mmx8861/p/9217445.html</a></li></ul><h3><span id="ssh-yu-ben-di-lian-jie">ssh与本地连接</span><a href="#ssh-yu-ben-di-lian-jie" class="header-anchor"></a></h3>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3&gt;&lt;span id=&quot;an-zhuang-vmvare-funshion&quot;&gt;安装 Vmvare Funshion&lt;/span&gt;&lt;a href=&quot;#an-zhuang-vmvare-funshion&quot; class=&quot;header-anchor&quot;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;h3&gt;&lt;s
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>资源下载</title>
    <link href="https://zuoyoulai.github.io/2020/03/06/%E8%B5%84%E6%BA%90%E5%9C%A8%E7%BA%BF%E4%B8%8E%E4%B8%8B%E8%BD%BD/"/>
    <id>https://zuoyoulai.github.io/2020/03/06/%E8%B5%84%E6%BA%90%E5%9C%A8%E7%BA%BF%E4%B8%8E%E4%B8%8B%E8%BD%BD/</id>
    <published>2020-03-06T05:50:59.000Z</published>
    <updated>2020-03-18T08:35:12.436Z</updated>
    
    <content type="html"><![CDATA[<h3><span id="tv-zi-yuan">Tv资源</span><a href="#tv-zi-yuan" class="header-anchor"></a></h3><ul><li>宅腐资源站 :  <a href="http://www.zhaifu.tv/" target="_blank" rel="noopener">http://www.zhaifu.tv/</a></li><li>fix 字幕组 : <a href="http://www.zimuxia.cn/" target="_blank" rel="noopener">http://www.zimuxia.cn/</a></li></ul><h3><span id="dian-ying-dian-shi-ju-xia-zai-zai-xian">电影电视剧下载在线</span><a href="#dian-ying-dian-shi-ju-xia-zai-zai-xian" class="header-anchor"></a></h3><ul><li>j8电影   :  <a href="https://www.j8dy.com/" target="_blank" rel="noopener">https://www.j8dy.com/</a></li><li>迅播动漫 - 动漫类 :  <a href="https://dm.xbdm.net/" target="_blank" rel="noopener">https://dm.xbdm.net/</a></li></ul>]]></content>
    
    <summary type="html">
    
      资源下载
    
    </summary>
    
    
      <category term="资源下载" scheme="https://zuoyoulai.github.io/categories/%E8%B5%84%E6%BA%90%E4%B8%8B%E8%BD%BD/"/>
    
    
      <category term="资源下载" scheme="https://zuoyoulai.github.io/tags/%E8%B5%84%E6%BA%90%E4%B8%8B%E8%BD%BD/"/>
    
      <category term="百度云" scheme="https://zuoyoulai.github.io/tags/%E7%99%BE%E5%BA%A6%E4%BA%91/"/>
    
  </entry>
  
  <entry>
    <title>es-head安装</title>
    <link href="https://zuoyoulai.github.io/2020/02/03/es-head%E5%AE%89%E8%A3%85/"/>
    <id>https://zuoyoulai.github.io/2020/02/03/es-head%E5%AE%89%E8%A3%85/</id>
    <published>2020-02-03T15:24:04.000Z</published>
    <updated>2020-02-13T13:37:38.712Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="es-head-an-zhuang">Es-Head 安装</span><a href="#es-head-an-zhuang" class="header-anchor"></a></h2><h3><span id="xiu-gai-es-de-pei-zhi-wen-jian">修改 Es 的配置文件</span><a href="#xiu-gai-es-de-pei-zhi-wen-jian" class="header-anchor"></a></h3><ul><li>主要为 Es 可以跨域请求操作,修改 Es 的配置文件: es.yml</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cluster.name: &quot;docker-cluster&quot;</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line"></span><br><span class="line">discovery.zen.minimum_master_nodes: 1</span><br><span class="line"></span><br><span class="line">#查看 head 的日志内容</span><br><span class="line">path.logs: &#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;logs</span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line">xpack.security.audit.enabled: true</span><br></pre></td></tr></table></figure><h3><span id="docker-compose-wen-jian-an-zhuang-head-cha-jian">docker-compose 文件安装 head 插件</span><a href="#docker-compose-wen-jian-an-zhuang-head-cha-jian" class="header-anchor"></a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">version: &#39;2&#39;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line"></span><br><span class="line">  elasticsearch:</span><br><span class="line">    image: &quot;elasticsearch:$&#123;ELK_VERSION&#125;&quot;</span><br><span class="line">    container_name: elasticsearch</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;9200:9200&quot;</span><br><span class="line">      - &quot;9300:9300&quot;</span><br><span class="line">    environment:</span><br><span class="line">      ES_JAVA_OPTS: &quot;-Xmx1024m -Xms1024m&quot;</span><br><span class="line">    #command: [&quot;bash&quot;, &quot;-c&quot;, &quot;echo &#39;discovery.type: single-node&#39;&gt;&gt;&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;config&#x2F;elasticsearch.yml; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-entrypoint.sh eswrapper&quot;]</span><br><span class="line">    command: [&quot;bash&quot;, &quot;-c&quot;, &quot;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-entrypoint.sh eswrapper&quot;]</span><br><span class="line">    volumes:</span><br><span class="line">      - .&#x2F;es-plugin&#x2F;ik:&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;plugins&#x2F;ik</span><br><span class="line">      - .&#x2F;node&#x2F;master&#x2F;data:&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;data:rw</span><br><span class="line">      - .&#x2F;node&#x2F;master&#x2F;config&#x2F;es.yml:&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;config&#x2F;elasticsearch.yml</span><br><span class="line">      - .&#x2F;node&#x2F;master&#x2F;logs:&#x2F;user&#x2F;share&#x2F;elasticsearch&#x2F;logs:rw</span><br><span class="line">    networks:</span><br><span class="line">      - elk</span><br><span class="line"></span><br><span class="line">  logstash:</span><br><span class="line">    image: &quot;logstash:$&#123;ELK_VERSION&#125;&quot;</span><br><span class="line">    container_name: logstash</span><br><span class="line">    volumes:</span><br><span class="line">      - .&#x2F;logstash&#x2F;pipeline:&#x2F;usr&#x2F;share&#x2F;logstash&#x2F;pipeline:ro</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;5000:5000&quot;</span><br><span class="line">    environment:</span><br><span class="line">      LS_JAVA_OPTS: &quot;-Xmx256m -Xms256m&quot;</span><br><span class="line">    depends_on:</span><br><span class="line">      - elasticsearch</span><br><span class="line">    command: [&quot;bash&quot;, &quot;-c&quot;, &quot;echo &#39;path.config: &#x2F;usr&#x2F;share&#x2F;logstash&#x2F;pipeline&#39;&gt;&gt;&#x2F;usr&#x2F;share&#x2F;logstash&#x2F;config&#x2F;logstash.yml; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-entrypoint&quot;]</span><br><span class="line">    networks:</span><br><span class="line">      - elk</span><br><span class="line"></span><br><span class="line">  kibana:</span><br><span class="line">    image: &quot;kibana:$&#123;ELK_VERSION&#125;&quot;</span><br><span class="line">    container_name: kibana</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;5601:5601&quot;</span><br><span class="line">    depends_on:</span><br><span class="line">      - elasticsearch</span><br><span class="line">    networks:</span><br><span class="line">      - elk</span><br><span class="line"></span><br><span class="line">  es-head:</span><br><span class="line">    image: tobias74&#x2F;elasticsearch-head:6</span><br><span class="line">    container_name: es-head</span><br><span class="line">    networks:</span><br><span class="line">      - elk</span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;9100:9100&quot;    </span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  elk:</span><br><span class="line">    driver: bridge</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      es-head安装
    
    </summary>
    
    
      <category term="es" scheme="https://zuoyoulai.github.io/categories/es/"/>
    
    
      <category term="es" scheme="https://zuoyoulai.github.io/tags/es/"/>
    
  </entry>
  
  <entry>
    <title>es性能优化篇</title>
    <link href="https://zuoyoulai.github.io/2020/02/03/es%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%AF%87/"/>
    <id>https://zuoyoulai.github.io/2020/02/03/es%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%AF%87/</id>
    <published>2020-02-03T15:24:04.000Z</published>
    <updated>2020-02-03T15:56:59.960Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="es-xing-neng-you-hua-pian">es性能优化篇</span><a href="#es-xing-neng-you-hua-pian" class="header-anchor"></a></h2><div class="toc"><!-- toc --><ul><li><a href="#suo-yin-fang-mian-de-you-hua">索引方面的优化</a></li><li><a href="#fu-wu-qi-fang-mian-de-you-hua">服务器方面的优化</a></li></ul><!-- tocstop --></div><ul><li><p>文章的参考来自: <a href="https://blog.csdn.net/u014646662/article/details/99293604" target="_blank" rel="noopener">https://blog.csdn.net/u014646662/article/details/99293604</a></p></li><li><p>优化的层面 : 索引方面  +  服务器层面</p></li></ul><h3><span id="suo-yin-fang-mian-de-you-hua">索引方面的优化</span><a href="#suo-yin-fang-mian-de-you-hua" class="header-anchor"></a></h3><h4><span id="zeng-jia-refresh-shi-jian-jian-ge">增加 Refresh 时间间隔</span><a href="#zeng-jia-refresh-shi-jian-jian-ge" class="header-anchor"></a></h4><ol><li><p>Elasticsearch 在写入数据时候，采用延迟写入的策略，即数据先写到内存中，当超过默认 1 秒</p></li><li><p>延长 refresh 时间间隔，可以有效的减少 segment 合并压力，提供索引速度。在做全链路跟踪的过程中，我们就将 index.refresh_interval 设置为 30s，减少 refresh 次数</p></li><li><p>在进行全量索引时，可以将 refresh 次数临时关闭，即 index.refresh_interval 设置为 -1，数据导入成功后再打开到正常模式，比如 30s</p></li><li><p>修改主配置文件 elasticsearch.yml 或者 Rest API 都可以对 index.refresh_interval 进行修改，增大该属性可以提升写入吞吐</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">PUT  &#x2F;_template&#x2F;&#123;TEMPLATE_NAME&#125;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;template&quot;:&quot;&#123;INDEX_PATTERN&#125;&quot;,</span><br><span class="line">  &quot;settings&quot; : &#123;</span><br><span class="line">    &quot;index.refresh_interval&quot; : &quot;30s&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">PUT &#123;INDEX_PAATERN&#125;&#x2F;_settings</span><br><span class="line">&#123;</span><br><span class="line">    &quot;index.refresh_interval&quot; : &quot;30s&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="jian-shao-fu-ben-shu-liang">减少副本数量</span><a href="#jian-shao-fu-ben-shu-liang" class="header-anchor"></a></h4><ul><li><p>Elasticsearch 默认副本数量为 3 个（7.x默认一个分片、一个副本），虽然这样会提高集群的可用性，增加搜索的并发数，但是同时也会影响写入索引的效率</p></li><li><p>在索引过程中，需要把更新的文档发到副本节点上，等副本节点生效后在进行返回结束。 使用 Elasticsearch 做业务搜索的时候，建议副本数目还是设置为 3 个，但是像内部 ELK 日志系统、分布式跟踪系统中，完全可以将副本数目设置为 1 个</p></li><li><p>在数据导入时，或是reindex的时候，可以将副本数改为0，等操作完毕后，在恢复事先定义的数目</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;settings&quot;: &#123;</span><br><span class="line">    &quot;number_of_replicas&quot;:0 </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4><span id="kai-qi-yi-bu-shua-xie">开启异步刷写</span><a href="#kai-qi-yi-bu-shua-xie" class="header-anchor"></a></h4><ul><li>如果允许数据丢失，可以对特定 index 开启异步刷写：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PUT  &#x2F;_template&#x2F;&#123;TEMPLATE_NAME&#125;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;template&quot;:&quot;&#123;INDEX_PATTERN&#125;&quot;,</span><br><span class="line">  &quot;settings&quot; : &#123;</span><br><span class="line">    &quot;index.translog.durability&quot;: &quot;async&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">PUT  &#123;INDEX_PAATERN&#125;&#x2F;_settings</span><br><span class="line">&#123;</span><br><span class="line">  &quot;index.translog.durability&quot;: &quot;async&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="kai-qi-man-cha-xun-ri-zhi">开启慢查询日志</span><a href="#kai-qi-man-cha-xun-ri-zhi" class="header-anchor"></a></h4><ul><li>不论是数据库还是搜索引擎，对于问题的排查，开启慢查询日志是十分必要的，ES 开启慢查询的方式有多种，但是最常用的是调用模板 API 进行全局设置</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">PUT  &#x2F;_template&#x2F;&#123;TEMPLATE_NAME&#125;</span><br><span class="line">&#123;</span><br><span class="line"> </span><br><span class="line">  &quot;template&quot;:&quot;&#123;INDEX_PATTERN&#125;&quot;,</span><br><span class="line">  &quot;settings&quot; : &#123;</span><br><span class="line">    &quot;index.indexing.slowlog.level&quot;: &quot;INFO&quot;,</span><br><span class="line">    &quot;index.indexing.slowlog.threshold.index.warn&quot;: &quot;10s&quot;,</span><br><span class="line">    &quot;index.indexing.slowlog.threshold.index.info&quot;: &quot;5s&quot;,</span><br><span class="line">    &quot;index.indexing.slowlog.threshold.index.debug&quot;: &quot;2s&quot;,</span><br><span class="line">    &quot;index.indexing.slowlog.threshold.index.trace&quot;: &quot;500ms&quot;,</span><br><span class="line">    &quot;index.indexing.slowlog.source&quot;: &quot;1000&quot;,</span><br><span class="line">    &quot;index.search.slowlog.level&quot;: &quot;INFO&quot;,</span><br><span class="line">    &quot;index.search.slowlog.threshold.query.warn&quot;: &quot;10s&quot;,</span><br><span class="line">    &quot;index.search.slowlog.threshold.query.info&quot;: &quot;5s&quot;,</span><br><span class="line">    &quot;index.search.slowlog.threshold.query.debug&quot;: &quot;2s&quot;,</span><br><span class="line">    &quot;index.search.slowlog.threshold.query.trace&quot;: &quot;500ms&quot;,</span><br><span class="line">    &quot;index.search.slowlog.threshold.fetch.warn&quot;: &quot;1s&quot;,</span><br><span class="line">    &quot;index.search.slowlog.threshold.fetch.info&quot;: &quot;800ms&quot;,</span><br><span class="line">    &quot;index.search.slowlog.threshold.fetch.debug&quot;: &quot;500ms&quot;,</span><br><span class="line">    &quot;index.search.slowlog.threshold.fetch.trace&quot;: &quot;200ms&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;version&quot;  : 1</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">PUT &#123;INDEX_PAATERN&#125;&#x2F;_settings</span><br><span class="line">&#123;</span><br><span class="line">    &quot;index.indexing.slowlog.level&quot;: &quot;INFO&quot;,</span><br><span class="line">    &quot;index.indexing.slowlog.threshold.index.warn&quot;: &quot;10s&quot;,</span><br><span class="line">    &quot;index.indexing.slowlog.threshold.index.info&quot;: &quot;5s&quot;,</span><br><span class="line">    &quot;index.indexing.slowlog.threshold.index.debug&quot;: &quot;2s&quot;,</span><br><span class="line">    &quot;index.indexing.slowlog.threshold.index.trace&quot;: &quot;500ms&quot;,</span><br><span class="line">    &quot;index.indexing.slowlog.source&quot;: &quot;1000&quot;,</span><br><span class="line">    &quot;index.search.slowlog.level&quot;: &quot;INFO&quot;,</span><br><span class="line">    &quot;index.search.slowlog.threshold.query.warn&quot;: &quot;10s&quot;,</span><br><span class="line">    &quot;index.search.slowlog.threshold.query.info&quot;: &quot;5s&quot;,</span><br><span class="line">    &quot;index.search.slowlog.threshold.query.debug&quot;: &quot;2s&quot;,</span><br><span class="line">    &quot;index.search.slowlog.threshold.query.trace&quot;: &quot;500ms&quot;,</span><br><span class="line">    &quot;index.search.slowlog.threshold.fetch.warn&quot;: &quot;1s&quot;,</span><br><span class="line">    &quot;index.search.slowlog.threshold.fetch.info&quot;: &quot;800ms&quot;,</span><br><span class="line">    &quot;index.search.slowlog.threshold.fetch.debug&quot;: &quot;500ms&quot;,</span><br><span class="line">    &quot;index.search.slowlog.threshold.fetch.trace&quot;: &quot;200ms&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">这样，在日志目录下的慢查询日志就会有输出记录必要的信息了:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;CLUSTER_NAME&#125;_index_indexing_slowlog.log</span><br><span class="line">&#123;CLUSTER_NAME&#125;_index_search_slowlog.log</span><br></pre></td></tr></table></figure><h3><span id="fu-wu-qi-fang-mian-de-you-hua">服务器方面的优化</span><a href="#fu-wu-qi-fang-mian-de-you-hua" class="header-anchor"></a></h3><h4><span id="nei-cun-she-zhi">内存设置</span><a href="#nei-cun-she-zhi" class="header-anchor"></a></h4><ul><li>由于ES构建基于lucene, 而lucene设计强大之处在于lucene能够很好的利用操作系统内存来缓存索引数据，以提供快速的查询性能。lucene的索引文件segements是存储在单文件中的，并且不可变，对于OS来说，能够很友好地将索引文件保持在cache中，以便快速访问；因此，我们很有必要将一半的物理内存留给lucene ; 另一半的物理内存留给ES（JVM heap )。所以， 在ES内存设置方面，可以遵循以下原则：</li></ul><ol><li>当机器内存小于64G时，遵循通用的原则，50%给ES，50%留给lucene。</li><li>当机器内存大于64G时，遵循以下原则： </li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">      a. 如果主要的使用场景是全文检索, 那么建议给ES Heap分配 4~32G的内存即可；其它内存留给操作系统, 供lucene使用（segments cache), 以提供更快的查询性能。</span><br><span class="line">      b.  如果主要的使用场景是聚合或排序， 并且大多数是numerics, dates, geo_points 以及not_analyzed的字符类型， 建议分配给ES Heap分配 4~32G的内存即可，其它内存留给操作系统，供lucene使用(doc values cache)，提供快速的基于文档的聚类、排序性能。 </span><br><span class="line">      c.  如果使用场景是聚合或排序，并且都是基于analyzed 字符数据，这时需要更多的 heap size, 建议机器上运行多ES实例，每个实例保持不超过50%的ES heap设置(但不超过32G，堆内存设置32G以下时，JVM使用对象指标压缩技巧节省空间)，50%以上留给lucene。</span><br><span class="line">      d. 当机器内存大于等于64G时，我们都会采用 31 G 设置</span><br><span class="line">          -Xms 31g</span><br><span class="line">          -Xmx 31g</span><br></pre></td></tr></table></figure><ol start="3"><li>禁止swap，一旦允许内存与磁盘的交换，会引起致命的性能问题。 通过： 在elasticsearch.yml 中 bootstrap.memory_lock: true， 以保持JVM锁定内存，保证ES的性能。</li><li>GC设置原则：</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">      a. 保持GC的现有设置，默认设置为：Concurrent-Mark and Sweep (CMS)，别换成G1GC，因为目前G1还有很多BUG。</span><br><span class="line">      b. 保持线程池的现有设置，目前ES的线程池较1.X有了较多优化设置，保持现状即可；默认线程池大小等于CPU核心数。如果一定要改，按公式（（CPU核心数* 3）&#x2F; 2）+ 1 设置；不能超过CPU核心数的2倍；但是不建议修改默认配置，否则会对CPU造成硬伤。</span><br><span class="line">      c.调整  elasticsearch.yml ，对 bulk&#x2F;flush 线程池进行调优</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    threadpool.bulk.type:fixed</span><br><span class="line">    threadpool.bulk.size:8 #(CPU核数)</span><br><span class="line">    threadpool.flush.type:fixed</span><br><span class="line">    threadpool.flush.size:8 #(CPU核数)</span><br></pre></td></tr></table></figure><h4><span id="ji-qun-fen-pian-she-zhi">集群分片设置</span><a href="#ji-qun-fen-pian-she-zhi" class="header-anchor"></a></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ES一旦创建好索引后，就无法调整分片的设置，而在ES中，一个分片实际上对应一个lucene 索引，而lucene索引的读写会占用很多的系统资源，因此，分片数不能设置过大；所以，在创建索引时，合理配置分片数是非常重要的。一般来说，我们遵循一些原则：</span><br><span class="line">    6.1 控制每个分片占用的硬盘容量不超过ES的最大JVM的堆空间设置（一般设置不超过32G，参加上文的JVM设置原则），因此，如果索引的总容量在500G左右，那分片大小在16个左右即可；当然，最好同时考虑原则6.2。</span><br><span class="line">    6.2 考虑一下node数量，一般一个节点有时候就是一台物理机，如果分片数过多，大大超过了节点数，很可能会导致一个节点上存在多个分片，一旦该节点故障，即使保持了1个以上的副本，同样有可能会导致数据丢失，集群无法恢复。所以， 一般都设置分片数不超过节点数的3倍。</span><br></pre></td></tr></table></figure><h4><span id="mapping-jian-mo">Mapping建模</span><a href="#mapping-jian-mo" class="header-anchor"></a></h4><ul><li>尽量避免使用nested或 parent/child，能不用就不用；nested query慢， parent/child query 更慢，比nested query慢上百倍；因此能在mapping设计阶段搞定的（大宽表设计或采用比较smart的数据结构），就不要用父子关系的mapping。</li><li>如果一定要使用nested fields，保证nested fields字段不能过多，目前ES默认限制是50。参考：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    index.mapping.nested_fields.limit ：50</span><br><span class="line">    因为针对1个document, 每一个nested field, 都会生成一个独立的document, 这将使Doc数量剧增，影响查询效率，尤其是JOIN的效率。</span><br></pre></td></tr></table></figure><ul><li>避免使用动态值作字段(key),  动态递增的mapping，会导致集群崩溃；同样，也需要控制字段的数量，业务中不使用的字段，就不要索引。控制索引的字段数量、mapping深度、索引字段的类型，对于ES的性能优化是重中之重。以下是ES关于字段数、mapping深度的一些默认设置：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">    index.mapping.nested_objects.limit :10000</span><br><span class="line">    index.mapping.total_fields.limit:1000</span><br><span class="line">    index.mapping.depth.limit: 20</span><br></pre></td></tr></table></figure><h4><span id="suo-yin-you-hua-she-zhi">索引优化设置</span><a href="#suo-yin-you-hua-she-zhi" class="header-anchor"></a></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">8.1 设置refresh_interval 为-1，同时设置number_of_replicas 为0，通过关闭refresh间隔周期，同时不设置副本来提高写性能。 </span><br><span class="line">    8.2 修改index_buffer_size 的设置，可以设置成百分数，也可设置成具体的大小，大小可根据集群的规模做不同的设置测试。 </span><br><span class="line">        indices.memory.index_buffer_size：10%（默认）</span><br><span class="line">        indices.memory.min_index_buffer_size： 48mb（默认）</span><br><span class="line">        indices.memory.max_index_buffer_size</span><br><span class="line">    8.3 修改translog相关的设置：</span><br><span class="line">        a. 控制数据从内存到硬盘的操作频率，以减少硬盘IO。可将sync_interval的时间设置大一些。</span><br><span class="line">            index.translog.sync_interval：5s(默认)。</span><br><span class="line">        b. 控制tranlog数据块的大小，达到threshold大小时，才会flush到lucene索引文件。</span><br><span class="line">            index.translog.flush_threshold_size：512mb(默认)</span><br><span class="line">    8.4 _id字段的使用，应尽可能避免自定义_id, 以避免针对ID的版本管理；建议使用ES的默认ID生成策略或使用数字类型ID做为主键。</span><br><span class="line">    8.5 _all字段及_source字段的使用，应该注意场景和需要，_all字段包含了所有的索引字段，方便做全文检索，如果无此需求，可以禁用；_source存储了原始的document内容，如果没有获取原始文档数据的需求，可通过设置includes、excludes 属性来定义放入_source的字段。</span><br><span class="line">    8.6 合理的配置使用index属性，analyzed 和not_analyzed，根据业务需求来控制字段是否分词或不分词。只有 groupby需求的字段，配置时就设置成not_analyzed, 以提高查询或聚类的效率。</span><br></pre></td></tr></table></figure><h4><span id="cha-xun-you-hua">查询优化</span><a href="#cha-xun-you-hua" class="header-anchor"></a></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">9.1 query_string 或 multi_match的查询字段越多， 查询越慢。可以在mapping阶段，利用copy_to属性将多字段的值索引到一个新字段，multi_match时，用新的字段查询。</span><br><span class="line">    9.2 日期字段的查询， 尤其是用now 的查询实际上是不存在缓存的，因此， 可以从业务的角度来考虑是否一定要用now, 毕竟利用query cache 是能够大大提高查询效率的。</span><br><span class="line">    9.3 查询结果集的大小不能随意设置成大得离谱的值， 如query.setSize不能设置成 Integer.MAX_VALUE， 因为ES内部需要建立一个数据结构来放指定大小的结果集数据。</span><br><span class="line">    9.4 尽量避免使用script，万不得已需要使用的话，选择painless &amp; experssions 引擎。一旦使用script查询，一定要注意控制返回，千万不要有死循环（如下错误的例子），因为ES没有脚本运行的超时控制，只要当前的脚本没执行完，该查询会一直阻塞。</span><br><span class="line">    9.5 避免层级过深的聚合查询， 层级过深的group by , 会导致内存、CPU消耗，建议在服务层通过程序来组装业务，也可以通过pipeline的方式来优化。</span><br><span class="line">    9.6 复用预索引数据方式来提高AGG性能：</span><br><span class="line">    如通过 terms aggregations 替代 range aggregations， 如要根据年龄来分组，分组目标是: 少年（14岁以下） 青年（14-28） 中年（29-50） 老年（51以上）， 可以在索引的时候设置一个age_group字段，预先将数据进行分类。从而不用按age来做range aggregations, 通过age_group字段就可以了。</span><br><span class="line">    9.7. Cache的设置及使用：</span><br><span class="line">        a) QueryCache: ES查询的时候，使用filter查询会使用query cache, 如果业务场景中的过滤查询比较多，建议将querycache设置大一些，以提高查询速度。</span><br><span class="line">        indices.queries.cache.size： 10%（默认），可设置成百分比，也可设置成具体值，如256mb。</span><br><span class="line">        当然也可以禁用查询缓存（默认是开启）， 通过index.queries.cache.enabled：false设置。</span><br><span class="line">        b) FieldDataCache: 在聚类或排序时，field data cache会使用频繁，因此，设置字段数据缓存的大小，在聚类或排序场景较多的情形下很有必要，可通过indices.fielddata.cache.size：30% 或具体值10GB来设置。但是如果场景或数据变更比较频繁，设置cache并不是好的做法，因为缓存加载的开销也是特别大的。</span><br><span class="line">        c) ShardRequestCache: 查询请求发起后，每个分片会将结果返回给协调节点(Coordinating Node), 由协调节点将结果整合。</span><br><span class="line">        如果有需求，可以设置开启;  通过设置index.requests.cache.enable: true来开启。</span><br><span class="line">        不过，shard request cache只缓存hits.total, aggregations, suggestions类型的数据，并不会缓存hits的内容。也可以通过设置indices.requests.cache.size: 1%（默认）来控制缓存空间大小。</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      es性能优化篇
    
    </summary>
    
    
      <category term="es" scheme="https://zuoyoulai.github.io/categories/es/"/>
    
    
      <category term="es" scheme="https://zuoyoulai.github.io/tags/es/"/>
    
  </entry>
  
  <entry>
    <title>Windows安装SecureCRT</title>
    <link href="https://zuoyoulai.github.io/2020/02/01/Windows%E5%AE%89%E8%A3%85SecureCRT/"/>
    <id>https://zuoyoulai.github.io/2020/02/01/Windows%E5%AE%89%E8%A3%85SecureCRT/</id>
    <published>2020-02-01T13:41:50.000Z</published>
    <updated>2020-02-01T16:56:17.838Z</updated>
    
    <content type="html"><![CDATA[<h3><span id="an-zhuang-jiao-cheng-can-kao-lian-jie">安装教程参考链接</span><a href="#an-zhuang-jiao-cheng-can-kao-lian-jie" class="header-anchor"></a></h3><ul><li><p><a href="https://www.jianshu.com/p/2bfd1fbf31bc" target="_blank" rel="noopener">https://www.jianshu.com/p/2bfd1fbf31bc</a></p></li><li><p>资料分享 : 链接：<a href="https://pan.baidu.com/s/1I3wgOL25tlb_AOoIDaJZxA" target="_blank" rel="noopener">https://pan.baidu.com/s/1I3wgOL25tlb_AOoIDaJZxA</a>  提取码：i7iz</p></li><li><p>SecureCRT注册机：链接：YPSuperKey Unlocked<a href="https://pan.baidu.com/s/1mZzUo9dswJ0vMl7d-96_3w" target="_blank" rel="noopener">https://pan.baidu.com/s/1mZzUo9dswJ0vMl7d-96_3w</a> 密码：lajx</p></li></ul><ul><li>具体详情的步骤:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">亲测可以哦</span><br><span class="line">一、 SecureCRT安装教程</span><br><span class="line">1、下载好安装包，双击“scrt814-x64”，进行安装</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">双击“scrt814-x64”</span><br><span class="line"></span><br><span class="line">2、点击next</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">点击next</span><br><span class="line"></span><br><span class="line">3、选择I accept the terms in the license agreement，在点击next</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">选择接受</span><br><span class="line"></span><br><span class="line">4、直接默认的配置，点击next</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">默认的配置即可</span><br><span class="line"></span><br><span class="line">5、默认配置，点击next</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">默认配置</span><br><span class="line"></span><br><span class="line">6、两个都选择，在点击next</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">两个都选</span><br><span class="line"></span><br><span class="line">7、安装路径不能改变，直接点击Install。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">安装</span><br><span class="line"></span><br><span class="line">8、三个选项的√都去掉，不去掉也可以，不去掉点击完成后会弹出网页。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">完成</span><br><span class="line"></span><br><span class="line">注意：完成之后先不要打开软件，先进行破解操作</span><br><span class="line">二、破解过程</span><br><span class="line">破解之前首先将杀毒软件关闭，或者只是将病毒与威胁防护实时保护关掉，不然，文件中的破解软件会被自动删除，关掉之后，如果破解软件已经被删除，就再重新解压一下压缩包就可以了。</span><br><span class="line"></span><br><span class="line">1、将破解包中的8.x 注册机文件夹下的keygen移动到SecureCRT 的安装路径下C:\Program Files\VanDyke Software\SecureCRT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">移动keygen</span><br><span class="line"></span><br><span class="line">2、右键、以管理员身份运行，点击patch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">管理员身份运行</span><br><span class="line"></span><br><span class="line">3、在弹出的框中先选择SecureCRT，再点击打开，之后会弹出成功页面</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">先选择、再点击打开</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">成功</span><br><span class="line"></span><br><span class="line">4、点击确认之后，有弹出文件选择界面，先选LicenseHelper，在点击打开，再次弹出成功界面，点击确定，放心，这次不会再弹出选择页面了0.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">先选择，再打开</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">成功</span><br><span class="line"></span><br><span class="line">5、不要关闭keygen，打开SecureCRT，弹出的页面直接点击ok即可，再选择Enter License Data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">点击ok</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6、什么也不填，直接下一步</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">直接下一步</span><br><span class="line"></span><br><span class="line">7、弹出的页面点击Enter License Manually</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">8、填入Keygen中的Name和Company，下一步</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ctrl c ctrl v</span><br><span class="line"></span><br><span class="line">9、填入Keygen中的Serial number和License key，下一步</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ctrl c ctrl v</span><br><span class="line"></span><br><span class="line">10、填入Issue date，下一步</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ctrl c ctrl v</span><br><span class="line"></span><br><span class="line">11、破解完成</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">完成</span><br><span class="line"></span><br><span class="line">12 、选择without a configuration passphrase，点击ok</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">选择第二个，点击ok</span><br><span class="line"></span><br><span class="line">13、破解完成，enjoy it！</span><br><span class="line">————————————————</span><br><span class="line">版权声明：本文为CSDN博主「xiaozhegaa」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。</span><br><span class="line">原文链接：https:&#x2F;&#x2F;blog.csdn.net&#x2F;xiaozhegaa&#x2F;article&#x2F;details&#x2F;89662874</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Windows安装SecureCRT
    
    </summary>
    
    
      <category term="SecureCRT" scheme="https://zuoyoulai.github.io/categories/SecureCRT/"/>
    
    
      <category term="SecureCRT" scheme="https://zuoyoulai.github.io/tags/SecureCRT/"/>
    
  </entry>
  
  <entry>
    <title>Java 操作 Es 查询操作</title>
    <link href="https://zuoyoulai.github.io/2020/01/31/java-es-02/"/>
    <id>https://zuoyoulai.github.io/2020/01/31/java-es-02/</id>
    <published>2020-01-30T16:06:24.000Z</published>
    <updated>2020-02-01T17:13:46.230Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="java-cao-zuo-es-cha-xun-cao-zuo">Java 操作 Es 查询操作</span><a href="#java-cao-zuo-es-cha-xun-cao-zuo" class="header-anchor"></a></h2><div class="toc"><!-- toc --><ul><li><a href="#xue-xi-can-kao-wen-zhang">学习参考文章</a></li></ul><!-- tocstop --></div><h3><span id="xue-xi-can-kao-wen-zhang">学习参考文章</span><a href="#xue-xi-can-kao-wen-zhang" class="header-anchor"></a></h3><ul><li><a href="https://blog.csdn.net/u014646662/category_8747782.html" target="_blank" rel="noopener">https://blog.csdn.net/u014646662/category_8747782.html</a></li></ul><ul><li>Es 的核心查询操作: 检索查询,聚合查询</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.transport.TransportClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.settings.Settings;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.transport.TransportAddress;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHit;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.aggregations.AggregationBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.aggregations.AggregationBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.aggregations.metrics.avg.Avg;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.aggregations.metrics.max.Max;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.aggregations.metrics.min.Min;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.aggregations.metrics.sum.Sum;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.transport.client.PreBuiltTransportClient;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 参考文章:</span></span><br><span class="line"><span class="comment"> *  https://www.jianshu.com/p/a584848da515</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * es 服务:</span></span><br><span class="line"><span class="comment"> *  http://localhost:9200/</span></span><br><span class="line"><span class="comment"> *  来查看 :  cluster.name</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * kibana 服务:</span></span><br><span class="line"><span class="comment"> *  http://localhost:5601/app/kibana#/dev_tools/console?_g=()</span></span><br><span class="line"><span class="comment"> *  来验证数据是否正确</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QueryTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    TransportClient transportClient = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String hostName = <span class="string">"localhost"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Integer port = <span class="number">9300</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Integer poolSize = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String index = <span class="string">"db-1"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String type = <span class="string">"tab-1"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 配置信息</span></span><br><span class="line">            Settings esSetting = Settings.builder()</span><br><span class="line">                    .put(<span class="string">"cluster.name"</span>, <span class="string">"docker-cluster"</span>) <span class="comment">//集群名字</span></span><br><span class="line"><span class="comment">//                    .put("client.transport.sniff", true)//增加嗅探机制，找到ES集群</span></span><br><span class="line">                    .put(<span class="string">"thread_pool.search.size"</span>, poolSize)<span class="comment">//增加线程池个数，暂时设为5</span></span><br><span class="line">                    .build();</span><br><span class="line">            <span class="comment">//配置信息Settings自定义</span></span><br><span class="line">            transportClient = <span class="keyword">new</span> PreBuiltTransportClient(esSetting);</span><br><span class="line">            TransportAddress transportAddress = <span class="keyword">new</span> TransportAddress(InetAddress.getByName(hostName), port);</span><br><span class="line">            transportClient.addTransportAddresses(transportAddress);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"elasticsearch TransportClient create error!!"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  根据条件进行查询的操作</span></span><br><span class="line"><span class="comment">     *  match query   知道分词器的存在，会对filed进行分词操作，然后再查询</span></span><br><span class="line"><span class="comment">     *  match_all:    查询所有文档</span></span><br><span class="line"><span class="comment">     *  multi_match:  可以指定多个字段</span></span><br><span class="line"><span class="comment">     *  match_phrase: 短语匹配查询，ElasticSearch引擎首先分析（analyze）查询字符串，从分析后的文本中构建短语查询，这意味着必须匹配短语中的所有分词，并且保证各个分词的相对位置不变</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">matchQuery</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对 age = 28 匹配</span></span><br><span class="line">        QueryBuilder fieldQuery = QueryBuilders.matchQuery(<span class="string">"age"</span>, <span class="number">98</span>);</span><br><span class="line">        log.info(<span class="string">"对 age = 28 匹配"</span>);</span><br><span class="line">        mathquery(fieldQuery);</span><br><span class="line">        log.info(<span class="string">"查询所有"</span>);</span><br><span class="line">        QueryBuilder allQuery = QueryBuilders.matchAllQuery();</span><br><span class="line">        mathquery(allQuery);</span><br><span class="line">        log.info(<span class="string">"matchPhrase查询"</span>);</span><br><span class="line">        log.info(<span class="string">"词语匹配短语 :    内容  --&gt;"</span>);</span><br><span class="line">        QueryBuilder matchQuery = QueryBuilders.matchPhraseQuery(<span class="string">"content"</span>, <span class="string">"内容  --&gt;1"</span>);</span><br><span class="line">        mathquery(matchQuery);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * term query会去倒排索引中寻找确切的term，它并不知道分词器的存在。这种查询适合keyword 、numeric、date</span></span><br><span class="line"><span class="comment">     * term:查询某个字段里含有某个关键词的文档</span></span><br><span class="line"><span class="comment">     * terms:查询某个字段里含有多个关键词的文档</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">termTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//content 字段有 "90" 字符</span></span><br><span class="line">        QueryBuilder oneTermBuilder = QueryBuilders.termQuery(<span class="string">"content"</span>, <span class="string">"90"</span>);</span><br><span class="line">        mathquery(oneTermBuilder);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">"---------"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//contetn 字段有 "内容1" 或 "97" 字符</span></span><br><span class="line">        QueryBuilder termsBuilder = QueryBuilders.termsQuery(<span class="string">"content"</span>, <span class="string">"内容1"</span>, <span class="string">"97"</span>);</span><br><span class="line">        mathquery(termsBuilder);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 聚合查询:</span></span><br><span class="line"><span class="comment">     * 求最大值 最小值 平均值 和值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jhTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//最大值</span></span><br><span class="line">        String maxName = <span class="string">"ageMax"</span>;</span><br><span class="line">        AggregationBuilder max = AggregationBuilders.max(maxName).field(<span class="string">"age"</span>);</span><br><span class="line">        log.info(<span class="string">" query DSL  :   &#123;&#125;"</span>, max.toString());</span><br><span class="line">        SearchResponse sr = transportClient.prepareSearch(index).addAggregation(max).get();</span><br><span class="line">        Max maxValue = sr.getAggregations().get(maxName);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">" data  :  &#123;&#125;"</span>, maxValue.toString());</span><br><span class="line">        log.info(<span class="string">" max value  :  &#123;&#125;"</span>, maxValue.getValue());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//最小值</span></span><br><span class="line">        String minName = <span class="string">"ageMin"</span>;</span><br><span class="line">        AggregationBuilder min = AggregationBuilders.min(minName).field(<span class="string">"age"</span>);</span><br><span class="line">        log.info(<span class="string">" query DSL  :   &#123;&#125;"</span>, min.toString());</span><br><span class="line">        SearchResponse mrep = transportClient.prepareSearch(index).addAggregation(min).get();</span><br><span class="line">        Min minValue = mrep.getAggregations().get(minName);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">" data  :  &#123;&#125;"</span>, minValue.toString());</span><br><span class="line">        log.info(<span class="string">" min value  :  &#123;&#125;"</span>, minValue.getValue());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//平均值</span></span><br><span class="line">        String avgName = <span class="string">"avgName"</span>;</span><br><span class="line">        AggregationBuilder avg = AggregationBuilders.avg(avgName).field(<span class="string">"age"</span>);</span><br><span class="line">        log.info(<span class="string">" query DSL  :   &#123;&#125;"</span>, avg.toString());</span><br><span class="line">        SearchResponse avgrep = transportClient.prepareSearch(index).addAggregation(avg).get();</span><br><span class="line">        Avg avgValue = avgrep.getAggregations().get(avgName);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">" data  :  &#123;&#125;"</span>, avgValue.toString());</span><br><span class="line">        log.info(<span class="string">" avg value  :  &#123;&#125;"</span>, avgValue.getValue());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//求和</span></span><br><span class="line">        String sumName = <span class="string">"avgName"</span>;</span><br><span class="line">        AggregationBuilder sum = AggregationBuilders.sum(sumName).field(<span class="string">"age"</span>);</span><br><span class="line">        log.info(<span class="string">" query DSL  :   &#123;&#125;"</span>, sum.toString());</span><br><span class="line">        SearchResponse sumrep = transportClient.prepareSearch(index).addAggregation(sum).get();</span><br><span class="line">        Sum sumValue = sumrep.getAggregations().get(sumName);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">" data  :  &#123;&#125;"</span>, sumValue.toString());</span><br><span class="line">        log.info(<span class="string">" avg value  :  &#123;&#125;"</span>, sumValue.getValue());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 返回结果:</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 00:03:15.444 [main] INFO com.demo.QueryTest -  query DSL  :   &#123;"ageMax":&#123;"max":&#123;"field":"age"&#125;&#125;&#125;</span></span><br><span class="line"><span class="comment">         * 00:03:15.556 [main] INFO com.demo.QueryTest -  data  :  &#123;"ageMax":&#123;"value":109.0&#125;&#125;</span></span><br><span class="line"><span class="comment">         * 00:03:15.556 [main] INFO com.demo.QueryTest -  max value  :  109.0</span></span><br><span class="line"><span class="comment">         * 00:03:15.556 [main] INFO com.demo.QueryTest -  query DSL  :   &#123;"ageMin":&#123;"min":&#123;"field":"age"&#125;&#125;&#125;</span></span><br><span class="line"><span class="comment">         * 00:03:15.572 [main] INFO com.demo.QueryTest -  data  :  &#123;"ageMin":&#123;"value":10.0&#125;&#125;</span></span><br><span class="line"><span class="comment">         * 00:03:15.572 [main] INFO com.demo.QueryTest -  min value  :  10.0</span></span><br><span class="line"><span class="comment">         * 00:03:15.572 [main] INFO com.demo.QueryTest -  query DSL  :   &#123;"avgName":&#123;"avg":&#123;"field":"age"&#125;&#125;&#125;</span></span><br><span class="line"><span class="comment">         * 00:03:15.587 [main] INFO com.demo.QueryTest -  data  :  &#123;"avgName":&#123;"value":67.77697841726619&#125;&#125;</span></span><br><span class="line"><span class="comment">         * 00:03:15.587 [main] INFO com.demo.QueryTest -  avg value  :  67.77697841726619</span></span><br><span class="line"><span class="comment">         * 00:03:15.588 [main] INFO com.demo.QueryTest -  query DSL  :   &#123;"avgName":&#123;"sum":&#123;"field":"age"&#125;&#125;&#125;</span></span><br><span class="line"><span class="comment">         * 00:03:15.607 [main] INFO com.demo.QueryTest -  data  :  &#123;"avgName":&#123;"value":9421.0&#125;&#125;</span></span><br><span class="line"><span class="comment">         * 00:03:15.607 [main] INFO com.demo.QueryTest -  avg value  :  9421.0</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">mathquery</span><span class="params">(QueryBuilder fieldQuery)</span> </span>&#123;</span><br><span class="line">        log.error(<span class="string">" query 语句 :  &#123;&#125;"</span>, fieldQuery.toString());</span><br><span class="line">        SearchResponse response = transportClient.prepareSearch(index).setQuery(fieldQuery).get();</span><br><span class="line">        <span class="keyword">for</span>(SearchHit hit:response.getHits()) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; map = hit.getSourceAsMap();</span><br><span class="line">            log.info(<span class="string">"query data  :   &#123;&#125;"</span>, JSON.toJSONString(map));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Java 操作 Es 查询操作
    
    </summary>
    
    
      <category term="elk" scheme="https://zuoyoulai.github.io/categories/elk/"/>
    
    
      <category term="elk" scheme="https://zuoyoulai.github.io/tags/elk/"/>
    
      <category term="java" scheme="https://zuoyoulai.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>java 操作 Es 的 CURD 操作</title>
    <link href="https://zuoyoulai.github.io/2020/01/30/java-es/"/>
    <id>https://zuoyoulai.github.io/2020/01/30/java-es/</id>
    <published>2020-01-29T16:17:10.000Z</published>
    <updated>2020-02-01T17:13:38.264Z</updated>
    
    <content type="html"><![CDATA[<h3><span id="java-cao-zuo-es-de-curd-cao-zuo">java 操作 Es 的 CURD 操作</span><a href="#java-cao-zuo-es-de-curd-cao-zuo" class="header-anchor"></a></h3><div class="toc"><!-- toc --><ul><li><a href="#xue-xi-can-kao-wen-zhang">学习参考文章</a></li><li><a href="#maven-yin-ru">maven 引入</a></li><li><a href="#can-kao-nei-rong">参考内容</a></li><li><a href="#java-dai-ma-curd">Java 代码 CURD</a></li></ul><!-- tocstop --></div><h3><span id="xue-xi-can-kao-wen-zhang">学习参考文章</span><a href="#xue-xi-can-kao-wen-zhang" class="header-anchor"></a></h3><ul><li><a href="https://blog.csdn.net/u014646662/category_8747782.html" target="_blank" rel="noopener">https://blog.csdn.net/u014646662/category_8747782.html</a></li></ul><h3><span id="maven-yin-ru">maven 引入</span><a href="#maven-yin-ru" class="header-anchor"></a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;properties&gt;</span><br><span class="line">        &lt;es.version&gt;6.4.2&lt;&#x2F;es.version&gt;</span><br><span class="line">&lt;&#x2F;properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.elasticsearch&#x2F;elasticsearch --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.elasticsearch&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;elasticsearch&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;es.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.elasticsearch.client&#x2F;transport --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.elasticsearch.client&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;transport&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;es.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;exclusions&gt;</span><br><span class="line">            &lt;exclusion&gt;</span><br><span class="line">                &lt;groupId&gt;org.elasticsearch&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;elasticsearch&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;&#x2F;exclusion&gt;</span><br><span class="line">        &lt;&#x2F;exclusions&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;&#x2F;dependencies&gt;</span><br></pre></td></tr></table></figure><h3><span id="can-kao-nei-rong">参考内容</span><a href="#can-kao-nei-rong" class="header-anchor"></a></h3><ul><li><p>参考文章 :  <a href="https://www.jianshu.com/p/a584848da515" target="_blank" rel="noopener">https://www.jianshu.com/p/a584848da515</a></p></li><li><p>验证数据 :  <a href="http://localhost:5601/app/kibana#/dev_tools" target="_blank" rel="noopener">http://localhost:5601/app/kibana#/dev_tools</a></p></li></ul><h3><span id="java-dai-ma-curd">Java 代码 CURD</span><a href="#java-dai-ma-curd" class="header-anchor"></a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Maps;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.delete.DeleteIndexResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.exists.indices.IndicesExistsRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.exists.indices.IndicesExistsResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.get.GetRequestBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.get.GetResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchRequestBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchType;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.update.UpdateRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.update.UpdateResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.transport.TransportClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.settings.Settings;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.text.Text;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.transport.TransportAddress;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHit;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.fetch.subphase.highlight.HighlightBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.fetch.subphase.highlight.HighlightField;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.sort.SortOrder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.transport.client.PreBuiltTransportClient;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutionException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 参考文章:</span></span><br><span class="line"><span class="comment"> *  https://www.jianshu.com/p/a584848da515</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * es 服务:</span></span><br><span class="line"><span class="comment"> *  http://localhost:9200/</span></span><br><span class="line"><span class="comment"> *  来查看 :  cluster.name</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * kibana 服务:</span></span><br><span class="line"><span class="comment"> *  http://localhost:5601/app/kibana#/dev_tools/console?_g=()</span></span><br><span class="line"><span class="comment"> *  来验证数据是否正确</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CurdTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    TransportClient transportClient = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String hostName = <span class="string">"localhost"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Integer port = <span class="number">9300</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Integer poolSize = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String index = <span class="string">"db-1"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String type = <span class="string">"tab-1"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 配置信息</span></span><br><span class="line">            Settings esSetting = Settings.builder()</span><br><span class="line">                    .put(<span class="string">"cluster.name"</span>, <span class="string">"docker-cluster"</span>) <span class="comment">//集群名字</span></span><br><span class="line"><span class="comment">//                    .put("client.transport.sniff", true)//增加嗅探机制，找到ES集群</span></span><br><span class="line">                    .put(<span class="string">"thread_pool.search.size"</span>, poolSize)<span class="comment">//增加线程池个数，暂时设为5</span></span><br><span class="line">                    .build();</span><br><span class="line">            <span class="comment">//配置信息Settings自定义</span></span><br><span class="line">            transportClient = <span class="keyword">new</span> PreBuiltTransportClient(esSetting);</span><br><span class="line">            TransportAddress transportAddress = <span class="keyword">new</span> TransportAddress(InetAddress.getByName(hostName), port);</span><br><span class="line">            transportClient.addTransportAddresses(transportAddress);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"elasticsearch TransportClient create error!!"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  新增操作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">oneInsert</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        String data = <span class="string">"&#123;\n"</span> +</span><br><span class="line">                <span class="string">"  \"cn-name\":\"java 赖\",\n"</span> +</span><br><span class="line">                <span class="string">"  \"en-name\":\"java es lai\",\n"</span> +</span><br><span class="line">                <span class="string">"  \"age\":28,\n"</span> +</span><br><span class="line">                <span class="string">"  \"content\":\"code 操作....\"\n"</span> +</span><br><span class="line">                <span class="string">"&#125;"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//这个版本需要把 json 字符串转为 map 对象  不然会报错</span></span><br><span class="line"></span><br><span class="line">        Map map = JSON.parseObject(data, Map<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        IndexResponse response = transportClient.prepareIndex(index, type).setSource(map).get();</span><br><span class="line">        log.info(<span class="string">"addData response status:&#123;&#125;,id:&#123;&#125;"</span>, response.status().getStatus(), response.getId());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  批量的插入的操作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchInsert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        BulkRequestBuilder bulkRequest = transportClient.prepareBulk();</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">60</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">                    Map map = Maps.newHashMap();</span><br><span class="line">                    map.put(<span class="string">"cn-name"</span>, <span class="string">"00"</span> + i);</span><br><span class="line">                    map.put(<span class="string">"en-name"</span>, <span class="string">"java samlai"</span> + i);</span><br><span class="line">                    map.put(<span class="string">"age"</span>, <span class="number">10</span> + i);</span><br><span class="line">                    map.put(<span class="string">"content"</span>, <span class="string">" 内容  --&gt;"</span> + i);</span><br><span class="line">                    IndexRequest request = transportClient.prepareIndex(index, type, String.valueOf(i)).setSource(map).request();</span><br><span class="line">                    bulkRequest.add(request);</span><br><span class="line">                &#125;</span><br><span class="line">        </span><br><span class="line">                bulkRequest.execute().actionGet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  删除操作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">del</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String id = <span class="string">"dpcY7G8BVtcun_3JK7HX"</span>;</span><br><span class="line">        DeleteResponse response = transportClient.prepareDelete(index, type, id).execute().actionGet();</span><br><span class="line">        log.info(<span class="string">"deleteDataById response status:&#123;&#125;,id:&#123;&#125;"</span>, response.status().getStatus(), response.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  删除 index 操作</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delIndex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isIndexExist(transportClient, index)) &#123;</span><br><span class="line">            log.info(<span class="string">"Index is not exits!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        DeleteIndexResponse dResponse = transportClient.admin().indices().prepareDelete(index).execute().actionGet();</span><br><span class="line">        <span class="keyword">if</span> (dResponse.isAcknowledged()) &#123;</span><br><span class="line">            log.info(<span class="string">"delete index "</span> + index + <span class="string">"  successfully!"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.info(<span class="string">"Fail to delete index "</span> + index);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        return dResponse.isAcknowledged();</span></span><br><span class="line">        log.info(<span class="string">"del Index  :   "</span> + dResponse.isAcknowledged());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改操作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        String data = <span class="string">"&#123;\n"</span> +</span><br><span class="line"><span class="comment">//                "  \"cn-name\":\"java 赖  update\"\n" +</span></span><br><span class="line">                <span class="string">"  \"cn-name\":\"java 赖  update\",\n"</span> +</span><br><span class="line">                <span class="string">"  \"en-name\":\"java es lai  ipdate\",\n"</span> +</span><br><span class="line">                <span class="string">"  \"age\":13,\n"</span> +</span><br><span class="line">                <span class="string">"  \"content\":\"update content\"\n"</span> +</span><br><span class="line">                <span class="string">"&#125;"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        String id = <span class="string">"d5dG7G8BVtcun_3JnrGp"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//这个版本需要把 json 字符串转为 map 对象  不然会报错</span></span><br><span class="line"></span><br><span class="line">        Map map = JSON.parseObject(data, Map<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        UpdateRequest updateRequest = <span class="keyword">new</span> UpdateRequest();</span><br><span class="line">        updateRequest.index(index).type(type).id(id).doc(map);</span><br><span class="line">        transportClient.update(updateRequest);</span><br><span class="line"></span><br><span class="line">        UpdateResponse result = transportClient.update(updateRequest).get();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 默认情况下，不更改任何内容的更新会检测到它们不会更改任何内容，并返回“结果”：“noop”</span></span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">" result :  "</span> + JSON.toJSONString(result));</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">" update data  ：  "</span> + JSON.toJSONString(result.getResult()));</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据 id 来查找 es 的数据内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">queryId</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String id = <span class="string">"d5dG7G8BVtcun_3JnrGp"</span>;</span><br><span class="line"></span><br><span class="line">        String fields = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        GetRequestBuilder getRequestBuilder = transportClient.prepareGet(index, type, id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(fields)) &#123;</span><br><span class="line">            getRequestBuilder.setFetchSource(fields.split(<span class="string">","</span>), <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        GetResponse getResponse = getRequestBuilder.execute().actionGet();</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">""</span>);</span><br><span class="line">        log.info(<span class="string">" reponse  data  :  "</span> + JSON.toJSONString(getResponse));</span><br><span class="line">        log.info(<span class="string">" data  :  "</span> + getResponse.getSource());</span><br><span class="line">        log.info(<span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用分词查询,并分页</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index          索引名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type           类型名称,可传入多个type逗号分隔</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> startPage      当前页</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageSize       每页显示条数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> query          查询条件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fields         需要显示的字段，逗号分隔（缺省为全部字段）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sortField      排序字段</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> highlightField 高亮字段</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">queryPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        SearchRequestBuilder searchRequestBuilder = transportClient.prepareSearch(index);</span><br><span class="line"></span><br><span class="line">        String fields = <span class="string">"content,en-name"</span>;</span><br><span class="line">        String sortField = <span class="string">"age"</span>;</span><br><span class="line">        String highlightField = <span class="string">"content"</span>;</span><br><span class="line"><span class="comment">//        String highlightField = "cn-name";</span></span><br><span class="line">        QueryBuilder query = QueryBuilders.boolQuery();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> startPage = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> pageSize = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(type)) &#123;</span><br><span class="line">            searchRequestBuilder.setTypes(type.split(<span class="string">","</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        searchRequestBuilder.setSearchType(SearchType.QUERY_THEN_FETCH);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 需要显示的字段，逗号分隔（缺省为全部字段）</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(fields)) &#123;</span><br><span class="line">            searchRequestBuilder.setFetchSource(fields.split(<span class="string">","</span>), <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//排序字段</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(sortField)) &#123;</span><br><span class="line">            searchRequestBuilder.addSort(sortField, SortOrder.DESC);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 高亮（xxx=111,aaa=222）</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(highlightField)) &#123;</span><br><span class="line"></span><br><span class="line">            HighlightBuilder highlightBuilder = <span class="keyword">new</span> HighlightBuilder();</span><br><span class="line"></span><br><span class="line">            highlightBuilder.preTags(<span class="string">"&lt;span style='color:red' &gt;"</span>);<span class="comment">//设置前缀</span></span><br><span class="line">            highlightBuilder.postTags(<span class="string">"&lt;/span&gt;"</span>);<span class="comment">//设置后缀</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 设置高亮字段</span></span><br><span class="line">            highlightBuilder.field(highlightField);</span><br><span class="line">            searchRequestBuilder.highlighter(highlightBuilder);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//searchRequestBuilder.setQuery(QueryBuilders.matchAllQuery());</span></span><br><span class="line">        searchRequestBuilder.setQuery(query);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 分页应用</span></span><br><span class="line">        searchRequestBuilder.setFrom(startPage).setSize(pageSize);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置是否按查询匹配度排序</span></span><br><span class="line">        searchRequestBuilder.setExplain(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//打印的内容 可以在 Elasticsearch head 和 Kibana  上执行查询</span></span><br><span class="line">        log.info(<span class="string">"\n&#123;&#125;"</span>, searchRequestBuilder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行搜索,返回搜索响应信息</span></span><br><span class="line">        SearchResponse searchResponse = searchRequestBuilder.execute().actionGet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> totalHits = searchResponse.getHits().totalHits;</span><br><span class="line">        <span class="keyword">long</span> length = searchResponse.getHits().getHits().length;</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">"共查询到[&#123;&#125;]条数据,处理数据条数[&#123;&#125;]"</span>, totalHits, length);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (searchResponse.status().getStatus() == <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="comment">// 解析对象</span></span><br><span class="line">            List&lt;Map&lt;String, Object&gt;&gt; sourceList = setSearchResponse(searchResponse, highlightField);</span><br><span class="line"></span><br><span class="line">            log.info(<span class="string">" "</span>);</span><br><span class="line">            log.info(<span class="string">" startPage  :  "</span> + startPage);</span><br><span class="line">            log.info(<span class="string">" pageSize  :  "</span> + pageSize);</span><br><span class="line">            log.info(<span class="string">" totalHits  :  "</span> + totalHits);</span><br><span class="line">            log.info(<span class="string">" sourceList  :  "</span> + JSON.toJSONString(sourceList));</span><br><span class="line">            log.info(<span class="string">" "</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断索引是否存在</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isIndexExist</span><span class="params">(TransportClient transportClient, String index)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        IndicesExistsResponse inExistsResponse = transportClient.admin().indices().exists(<span class="keyword">new</span> IndicesExistsRequest(index)).actionGet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (inExistsResponse.isExists()) &#123;</span><br><span class="line">            log.info(<span class="string">"Index ["</span> + index + <span class="string">"] is exist!"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.info(<span class="string">"Index ["</span> + index + <span class="string">"] is not exist!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> inExistsResponse.isExists();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span>: 判断inde下指定type是否存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isTypeExist</span><span class="params">(TransportClient transportClient, String index, String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isIndexExist(transportClient, index)</span><br><span class="line">                ? transportClient.admin().indices().prepareTypesExists(index).setTypes(type).execute().actionGet().isExists()</span><br><span class="line">                : <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 高亮结果集 特殊处理</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> searchResponse</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> highlightField</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;Map&lt;String, Object&gt;&gt; setSearchResponse(SearchResponse searchResponse, String highlightField) &#123;</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; sourceList = <span class="keyword">new</span> ArrayList&lt;Map&lt;String, Object&gt;&gt;();</span><br><span class="line">        StringBuffer stringBuffer = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (SearchHit searchHit : searchResponse.getHits().getHits()) &#123;</span><br><span class="line">            searchHit.getSourceAsMap().put(<span class="string">"id"</span>, searchHit.getId());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isNotEmpty(highlightField)) &#123;</span><br><span class="line"></span><br><span class="line">                log.info(<span class="string">"遍历 高亮结果集，覆盖 正常结果集"</span> + searchHit.getSourceAsMap());</span><br><span class="line"></span><br><span class="line">                HighlightField field = searchHit.getHighlightFields().get(highlightField);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (field != <span class="keyword">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">                    Text[] text = field.getFragments();</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (text != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (Text str : text) &#123;</span><br><span class="line">                            stringBuffer.append(str.string());</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">//遍历 高亮结果集，覆盖 正常结果集</span></span><br><span class="line">                        searchHit.getSourceAsMap().put(highlightField, stringBuffer.toString());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            sourceList.add(searchHit.getSourceAsMap());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sourceList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      java 操作 Es 的 CURD 操作
    
    </summary>
    
    
      <category term="elk" scheme="https://zuoyoulai.github.io/categories/elk/"/>
    
    
      <category term="elk" scheme="https://zuoyoulai.github.io/tags/elk/"/>
    
      <category term="java" scheme="https://zuoyoulai.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>xxx-job 分布式定时任务系统</title>
    <link href="https://zuoyoulai.github.io/2020/01/28/xxx-job/"/>
    <id>https://zuoyoulai.github.io/2020/01/28/xxx-job/</id>
    <published>2020-01-28T04:09:50.000Z</published>
    <updated>2020-01-29T16:21:53.399Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="xxx-job-fen-bu-shi-ding-shi-ren-wu-xi-tong">xxx-job 分布式定时任务系统</span><a href="#xxx-job-fen-bu-shi-ding-shi-ren-wu-xi-tong" class="header-anchor"></a></h2><div class="toc"><!-- toc --><ul><li><a href="#lai-yuan">来源</a></li><li><a href="#huan-jing-zhun-bei">环境准备</a></li></ul><!-- tocstop --></div>### 来源<ul><li>官方文档 :  <a href="https://www.xuxueli.com/index.html" target="_blank" rel="noopener">https://www.xuxueli.com/index.html</a></li></ul><h3><span id="huan-jing-zhun-bei">环境准备</span><a href="#huan-jing-zhun-bei" class="header-anchor"></a></h3><ul><li>docker镜像</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull xuxueli&#x2F;xxl-job-admin:2.1.2</span><br></pre></td></tr></table></figure><ul><li>ip地址查看</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~ » ifconfig | grep &quot;inet &quot; | grep -v 127.0.0.1                                                      haodalai@localhost</span><br><span class="line">inet 192.168.31.164 netmask 0xffffff00 broadcast 192.168.31.255</span><br></pre></td></tr></table></figure><ul><li>启动docker 镜像</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -e PARAMS&#x3D;&quot;--spring.datasource.url&#x3D;jdbc:mysql:&#x2F;&#x2F;192.168.31.164:3307&#x2F;xxl_job?Unicode&#x3D;true&amp;characterEncoding&#x3D;UTF-8   --spring.datasource.password&#x3D;samlai123&quot; -p 8787:8080 -v &#x2F;Users&#x2F;haodalai&#x2F;docker&#x2F;xxx-job&#x2F;logs:&#x2F;data&#x2F;applogs --name xxl-job-admin  -d xuxueli&#x2F;xxl-job-admin:2.1.2</span><br></pre></td></tr></table></figure><ul><li><p>访问地址 :  <a href="http://localhost:8787/xxl-job-admin" target="_blank" rel="noopener">http://localhost:8787/xxl-job-admin</a></p></li><li><p>访问的账号与密码: admin/123456</p></li></ul>]]></content>
    
    <summary type="html">
    
      分布式定时任务系统-job
    
    </summary>
    
    
      <category term="分布式定时任务系统" scheme="https://zuoyoulai.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E7%B3%BB%E7%BB%9F/"/>
    
    
      <category term="分布式定时任务系统" scheme="https://zuoyoulai.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E7%B3%BB%E7%BB%9F/"/>
    
      <category term="xxx-job" scheme="https://zuoyoulai.github.io/tags/xxx-job/"/>
    
  </entry>
  
  <entry>
    <title>docker 部署使用 ELk</title>
    <link href="https://zuoyoulai.github.io/2020/01/27/elk/"/>
    <id>https://zuoyoulai.github.io/2020/01/27/elk/</id>
    <published>2020-01-27T15:47:27.000Z</published>
    <updated>2020-02-02T12:41:45.359Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="docker-bu-shu-shi-yong-elk">docker 部署使用 ELk</span><a href="#docker-bu-shu-shi-yong-elk" class="header-anchor"></a></h2><div class="toc"><!-- toc --><ul><li><a href="#xue-xi-can-kao-wen-zhang">学习参考文章</a></li><li><a href="#ji-chu-la-qu-jing-xiang">基础 : 拉取镜像</a></li><li><a href="#ji-cheng-elk">集成:ELK</a><ul><li><a href="#fang-wen-fu-wu">访问服务</a></li><li><a href="#ik-fen-ci-qi-shi-fou-an-zhuang-cheng-gong-zai-kibana-shang-zhi-xing-cao-zuo">IK 分词器是否安装成功,在 kibana 上执行操作</a></li><li><a href="#kibana-cao-zuo-es-zeng-shan-gai-cha-cao-zuo">kibana 操作 Es 增删该查操作</a></li></ul></li><li><a href="#gai-nian">概念</a></li><li><a href="#kibana-dui-es-zeng-shan-gai-cha">kibana 对 es 增删改查</a><ul><li><a href="#es-yu-fa-gao-liang-cha-xun">Es 语法高亮查询</a></li><li><a href="#es-cha-xun-fen-lei-query-string-search-query-dsl">Es 查询分类 :  query string search  /  query DSL</a></li><li><a href="#full-text-search-quan-wen-jian-suo-phrase-search-duan-yu-sou-suo">full-text search 全文检索   |   phrase search  短语搜索</a></li><li><a href="#es-pi-liang-de-cao-zuo">Es批量的操作</a></li><li><a href="#es-he-xin-de-cao-zuo-huan-shi-cha-xun-cao-zuo-shi-yong-query-dsl-qing-qiu-cha-xun">Es 核心的操作还是查询操作: 使用query DSL 请求查询</a></li></ul></li></ul><!-- tocstop --></div><h3><span id="xue-xi-can-kao-wen-zhang">学习参考文章</span><a href="#xue-xi-can-kao-wen-zhang" class="header-anchor"></a></h3><ul><li><a href="https://blog.csdn.net/u014646662/category_8747782.html" target="_blank" rel="noopener">https://blog.csdn.net/u014646662/category_8747782.html</a></li></ul><h3><span id="ji-chu-la-qu-jing-xiang">基础 : 拉取镜像</span><a href="#ji-chu-la-qu-jing-xiang" class="header-anchor"></a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker pull elasticsearch:6.5.4</span><br><span class="line">docker pull kibana:6.5.4</span><br><span class="line">docker pull logstash:6.5.4</span><br></pre></td></tr></table></figure><h3><span id="ji-cheng-elk">集成:ELK</span><a href="#ji-cheng-elk" class="header-anchor"></a></h3><ul><li><p>工具: docker-compose</p></li><li><p>版本的指定: 在 compose 文件下有.env 文件写上相应的版本号内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ELK_VERSION&#x3D;6.5.4</span><br></pre></td></tr></table></figure></li><li><p>添加相应版本分词插件:IK (github 地址版本: <a href="https://github.com/medcl/elasticsearch-analysis-ik/releases?after=v6.5.2" target="_blank" rel="noopener">https://github.com/medcl/elasticsearch-analysis-ik/releases?after=v6.5.2</a>)</p></li><li><p>Ik 的说明文章: <a href="https://github.com/medcl/elasticsearch-analysis-ik" target="_blank" rel="noopener">https://github.com/medcl/elasticsearch-analysis-ik</a></p></li><li><p>集成到 docker-compose 上:</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">下载相应的文件:</span><br><span class="line">wget https:&#x2F;&#x2F;github.com&#x2F;medcl&#x2F;elasticsearch-analysis-ik&#x2F;releases&#x2F;download&#x2F;v6.5.0&#x2F;elasticsearch-analysis-ik-6.5.0.zip</span><br><span class="line"></span><br><span class="line">解压到相应 compose文件根目录下:es-plugin&#x2F;ik 下  :  unzip ik.zip</span><br><span class="line"></span><br><span class="line">docker-compose 文件对 Es 的文件夹的指定:</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  - .&#x2F;es-plugin&#x2F;ik:&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;plugins&#x2F;ik</span><br></pre></td></tr></table></figure><ul><li>compose 文件内容<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">version: &#39;2&#39;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line"></span><br><span class="line">  elasticsearch:</span><br><span class="line">    image: &quot;elasticsearch:$&#123;ELK_VERSION&#125;&quot;</span><br><span class="line">    container_name: elasticsearch</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;9200:9200&quot;</span><br><span class="line">      - &quot;9300:9300&quot;</span><br><span class="line">    environment:</span><br><span class="line">      ES_JAVA_OPTS: &quot;-Xmx1024m -Xms1024m&quot;</span><br><span class="line">    #command: [&quot;bash&quot;, &quot;-c&quot;, &quot;echo &#39;discovery.type: single-node&#39;&gt;&gt;&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;config&#x2F;elasticsearch.yml; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-entrypoint.sh eswrapper&quot;]</span><br><span class="line">    command: [&quot;bash&quot;, &quot;-c&quot;, &quot;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-entrypoint.sh eswrapper&quot;]</span><br><span class="line">    # Ik 分词器的安装</span><br><span class="line">    volumes:</span><br><span class="line">       - .&#x2F;es-plugin&#x2F;ik:&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;plugins&#x2F;ik</span><br><span class="line">    networks:</span><br><span class="line">      - elk</span><br><span class="line"></span><br><span class="line">  logstash:</span><br><span class="line">    image: &quot;logstash:$&#123;ELK_VERSION&#125;&quot;</span><br><span class="line">    container_name: logstash</span><br><span class="line">    volumes:</span><br><span class="line">      - .&#x2F;logstash&#x2F;pipeline:&#x2F;usr&#x2F;share&#x2F;logstash&#x2F;pipeline:ro</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;5000:5000&quot;</span><br><span class="line">    environment:</span><br><span class="line">      LS_JAVA_OPTS: &quot;-Xmx256m -Xms256m&quot;</span><br><span class="line">    depends_on:</span><br><span class="line">      - elasticsearch</span><br><span class="line">    command: [&quot;bash&quot;, &quot;-c&quot;, &quot;echo &#39;path.config: &#x2F;usr&#x2F;share&#x2F;logstash&#x2F;pipeline&#39;&gt;&gt;&#x2F;usr&#x2F;share&#x2F;logstash&#x2F;config&#x2F;logstash.yml; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-entrypoint&quot;]</span><br><span class="line">    networks:</span><br><span class="line">      - elk</span><br><span class="line"></span><br><span class="line">  kibana:</span><br><span class="line">    image: &quot;kibana:$&#123;ELK_VERSION&#125;&quot;</span><br><span class="line">    container_name: kibana</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;5601:5601&quot;</span><br><span class="line">    depends_on:</span><br><span class="line">      - elasticsearch</span><br><span class="line">    networks:</span><br><span class="line">      - elk</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  elk:</span><br><span class="line">    driver: bridge</span><br></pre></td></tr></table></figure></li></ul><h2><span id="fang-wen-fu-wu">访问服务</span><a href="#fang-wen-fu-wu" class="header-anchor"></a></h2><ul><li>访问 Es :  <a href="http://localhost:9200/" target="_blank" rel="noopener">http://localhost:9200/</a></li><li>访问 kibana : <a href="http://localhost:5601" target="_blank" rel="noopener">http://localhost:5601</a></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. 打开dev Tools</span><br><span class="line">2. 在窗口进行查询 :  GET &#x2F;_search</span><br></pre></td></tr></table></figure><h2><span id="ik-fen-ci-qi-shi-fou-an-zhuang-cheng-gong-zai-kibana-shang-zhi-xing-cao-zuo">IK 分词器是否安装成功,在 kibana 上执行操作</span><a href="#ik-fen-ci-qi-shi-fou-an-zhuang-cheng-gong-zai-kibana-shang-zhi-xing-cao-zuo" class="header-anchor"></a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">GET &#x2F;_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;你好，我是中国人&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">返回的结果:</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;你好&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 2,</span><br><span class="line">      &quot;type&quot; : &quot;CN_WORD&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;我&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 3,</span><br><span class="line">      &quot;end_offset&quot; : 4,</span><br><span class="line">      &quot;type&quot; : &quot;CN_CHAR&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;是&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 4,</span><br><span class="line">      &quot;end_offset&quot; : 5,</span><br><span class="line">      &quot;type&quot; : &quot;CN_CHAR&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;中国人&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 5,</span><br><span class="line">      &quot;end_offset&quot; : 8,</span><br><span class="line">      &quot;type&quot; : &quot;CN_WORD&quot;,</span><br><span class="line">      &quot;position&quot; : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;中国&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 5,</span><br><span class="line">      &quot;end_offset&quot; : 7,</span><br><span class="line">      &quot;type&quot; : &quot;CN_WORD&quot;,</span><br><span class="line">      &quot;position&quot; : 4</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;国人&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 6,</span><br><span class="line">      &quot;end_offset&quot; : 8,</span><br><span class="line">      &quot;type&quot; : &quot;CN_WORD&quot;,</span><br><span class="line">      &quot;position&quot; : 5</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="kibana-cao-zuo-es-zeng-shan-gai-cha-cao-zuo">kibana 操作 Es 增删该查操作</span><a href="#kibana-cao-zuo-es-zeng-shan-gai-cha-cao-zuo" class="header-anchor"></a></h2><h3><span id="gai-nian">概念</span><a href="#gai-nian" class="header-anchor"></a></h3><ul><li>类比:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Relational DB -&gt; Databases -&gt; Tables -&gt; Rows -&gt; Columns</span><br><span class="line">Elasticsearch -&gt; Indices   -&gt; Types  -&gt; Documents -&gt; Fields</span><br></pre></td></tr></table></figure><h3><span id="kibana-dui-es-zeng-shan-gai-cha">kibana 对 es 增删改查</span><a href="#kibana-dui-es-zeng-shan-gai-cha" class="header-anchor"></a></h3><ul><li><p>概念文档:  <a href="http://blog.didispace.com/books/elasticsearch-definitive-guide-cn/010_Intro/00_README.html" target="_blank" rel="noopener">http://blog.didispace.com/books/elasticsearch-definitive-guide-cn/010_Intro/00_README.html</a></p></li><li><p>例子文档:  <a href="https://blog.csdn.net/u014646662/category_8747782_2.html" target="_blank" rel="noopener">https://blog.csdn.net/u014646662/category_8747782_2.html</a></p></li></ul><ul><li>查看集群健康信息</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">GET &#x2F;_cat&#x2F;health?v</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Green（正常）</span><br><span class="line">Yellow（正常，但是一些副本还没有分配）</span><br><span class="line">Red（非正常）</span><br></pre></td></tr></table></figure><ul><li>查看集群，索引，分片情况:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">GET &#x2F;_cat&#x2F;indices?v&amp;h&#x3D;health,status,index</span><br></pre></td></tr></table></figure><ul><li>查看查询全部内容</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">GET &#x2F;_search</span><br></pre></td></tr></table></figure><ul><li>增加一个 document 内容,格式 : POST /{index}/{type}   不加 id 则系统默认给出一个 id</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">POST &#x2F;db-1&#x2F;tab-1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;cn-name&quot;:&quot;赖豪达&quot;,</span><br><span class="line">  &quot;en-name&quot;:&quot;samlai&quot;,</span><br><span class="line">  &quot;age&quot;:28,</span><br><span class="line">  &quot;content&quot;:&quot;我的简介操作....&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">返回的结果:</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;_index&quot; : &quot;db-1&quot;,</span><br><span class="line">  &quot;_type&quot; : &quot;tab-1&quot;,</span><br><span class="line">  &quot;_id&quot; : &quot;dZc56m8BVtcun_3JvbEQ&quot;,</span><br><span class="line">  &quot;_version&quot; : 1,</span><br><span class="line">  &quot;result&quot; : &quot;created&quot;,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 2,</span><br><span class="line">    &quot;successful&quot; : 1,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_seq_no&quot; : 1,</span><br><span class="line">  &quot;_primary_term&quot; : 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">or 自己指定一个 id :</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">POST &#x2F;db-1&#x2F;tab-1&#x2F;1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;cn-name&quot;:&quot;赖豪达&quot;,</span><br><span class="line">  &quot;en-name&quot;:&quot;samlai&quot;,</span><br><span class="line">  &quot;age&quot;:28,</span><br><span class="line">  &quot;content&quot;:&quot;我的简介操作....&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>删除一个 document 内容: DELETE /{index}/{type}/{id}</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">DELETE db-1&#x2F;tab-1&#x2F;dJcs6m8BVtcun_3JbrGq</span><br></pre></td></tr></table></figure><ul><li>修改的操作,分覆盖全部 与 修改某些字段:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1. </span><br><span class="line"></span><br><span class="line">覆盖全部字段:</span><br><span class="line"></span><br><span class="line">PUT &#x2F;db-1&#x2F;tab-1&#x2F;2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;cn-name&quot;:&quot;赖豪达0002  修改---&quot;,</span><br><span class="line">  &quot;en-name&quot;:&quot;samlai0002&quot;,</span><br><span class="line">  &quot;age&quot;:28,</span><br><span class="line">  &quot;content&quot;:&quot;我的简介操作....0002&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.</span><br><span class="line"></span><br><span class="line">修改某些字段内容:</span><br><span class="line"></span><br><span class="line">POST db-1&#x2F;tab-1&#x2F;1&#x2F;_update</span><br><span class="line">&#123;</span><br><span class="line">  &quot;doc&quot;: &#123;</span><br><span class="line">    &quot;en-name&quot;:&quot;我的英文名字是:赖豪达&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">返回结果:</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;_index&quot; : &quot;db-1&quot;,</span><br><span class="line">  &quot;_type&quot; : &quot;tab-1&quot;,</span><br><span class="line">  &quot;_id&quot; : &quot;1&quot;,</span><br><span class="line">  &quot;_version&quot; : 2,</span><br><span class="line">  &quot;result&quot; : &quot;noop&quot;,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 0,</span><br><span class="line">    &quot;successful&quot; : 0,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>查询一个 document 内容 : GET /{index}/{type}/{id}</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">1.</span><br><span class="line"></span><br><span class="line">GET db-1&#x2F;tab-1&#x2F;dJcs6m8BVtcun_3JbrGq</span><br><span class="line"></span><br><span class="line">返回结果:</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;_index&quot; : &quot;db-1&quot;,</span><br><span class="line">  &quot;_type&quot; : &quot;tab-1&quot;,</span><br><span class="line">  &quot;_id&quot; : &quot;dZc56m8BVtcun_3JvbEQ&quot;,</span><br><span class="line">  &quot;_version&quot; : 1,</span><br><span class="line">  &quot;found&quot; : true,</span><br><span class="line">  &quot;_source&quot; : &#123;</span><br><span class="line">    &quot;cn-name&quot; : &quot;赖豪达&quot;,</span><br><span class="line">    &quot;en-name&quot; : &quot;samlai&quot;,</span><br><span class="line">    &quot;age&quot; : 28,</span><br><span class="line">    &quot;content&quot; : &quot;我的简介操作....&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.</span><br><span class="line"></span><br><span class="line">GET db-1&#x2F;tab-1&#x2F;dJcs6m8BVtcun_3JbrGq&#x2F;_source</span><br><span class="line"></span><br><span class="line">返回结果:</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;cn-name&quot; : &quot;赖豪达&quot;,</span><br><span class="line">  &quot;en-name&quot; : &quot;samlai&quot;,</span><br><span class="line">  &quot;age&quot; : 28,</span><br><span class="line">  &quot;content&quot; : &quot;我的简介操作....&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="es-yu-fa-gao-liang-cha-xun">Es 语法高亮查询</span><a href="#es-yu-fa-gao-liang-cha-xun" class="header-anchor"></a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">GET db-1&#x2F;tab-1&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">  &quot;term&quot;: &#123;</span><br><span class="line">    &quot;cn-name&quot;: &quot;0018&quot;</span><br><span class="line">  &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      &quot;cn-name&quot;: &#123;</span><br><span class="line">        &quot;pre_tags&quot;:[&quot;&lt;mark&gt;&quot;],</span><br><span class="line">        &quot;post_tags&quot;:[&quot;&lt;&#x2F;mark&gt;&quot;]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">返回结果:</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;took&quot; : 46,</span><br><span class="line">  &quot;timed_out&quot; : false,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 5,</span><br><span class="line">    &quot;successful&quot; : 5,</span><br><span class="line">    &quot;skipped&quot; : 0,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 1,</span><br><span class="line">    &quot;max_score&quot; : 2.5389738,</span><br><span class="line">    &quot;hits&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;db-1&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;tab-1&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;18&quot;,</span><br><span class="line">        &quot;_score&quot; : 2.5389738,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;cn-name&quot; : &quot;0018&quot;,</span><br><span class="line">          &quot;en-name&quot; : &quot;java samlai18&quot;,</span><br><span class="line">          &quot;age&quot; : 28,</span><br><span class="line">          &quot;content&quot; : &quot; 内容  --&gt;18&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;highlight&quot; : &#123;</span><br><span class="line">          &quot;cn-name&quot; : [</span><br><span class="line">            &quot;&lt;mark&gt;0018&lt;&#x2F;mark&gt;&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="es-cha-xun-fen-lei-query-string-search-query-dsl">Es 查询分类 :  query string search  /  query DSL</span><a href="#es-cha-xun-fen-lei-query-string-search-query-dsl" class="header-anchor"></a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">第一种：类似搜索全部商品： GET &#x2F;ecommerce&#x2F;product&#x2F;_search (参数直接拼接在请求上，不带json参数的)</span><br><span class="line"></span><br><span class="line">　　　　　　query  string search的由来，因为search参数都是以http请求的query string来附带的。</span><br><span class="line"></span><br><span class="line">　　　　　　搜索商品名称中包含yagao的商品，而且按照售价降序排列：</span><br><span class="line"></span><br><span class="line">　　　　　　　　 GET &#x2F;ecommerce&#x2F;product&#x2F;_search?q&#x3D;name:yagao&amp;sort&#x3D;price:desc</span><br><span class="line"></span><br><span class="line">　　　　　　适用于临时的在命令行使用一些工具，比如curl，快速的发出请求，来检索想要的信息；但是</span><br><span class="line"></span><br><span class="line">　　　　　　如果查询请求很复杂，是很难去构建的，所以在生产环境中，几乎很少使用query string search。</span><br><span class="line"></span><br><span class="line">　　第二种：DSL：Domain Specified Language,特定领域的语言</span><br><span class="line"></span><br><span class="line">　　　　　　http request body:请求体，可以用json的格式来构建查询语法，比较方便，可以构建各种复杂的语法，</span><br><span class="line"></span><br><span class="line">　　　　　　比query string search肯定强大太多了。</span><br></pre></td></tr></table></figure><h2><span id="full-text-search-quan-wen-jian-suo-phrase-search-duan-yu-sou-suo">full-text search 全文检索   |   phrase search  短语搜索</span><a href="#full-text-search-quan-wen-jian-suo-phrase-search-duan-yu-sou-suo" class="header-anchor"></a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">全文检索:</span><br><span class="line">会将输入的搜索串拆解开来，去索引里面去一一匹配，只要能匹配任意一个拆解后的单词，就可以作为结果返回</span><br><span class="line"></span><br><span class="line">短语搜索:</span><br><span class="line">要求输入的搜索串，必须在指定的字段文本中，完全包含一模一样的，才可以算匹配成功，才能作为结果返回</span><br></pre></td></tr></table></figure><ul><li>多条件查询中的字段描述</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">must：　　表示一定要满足；</span><br><span class="line"></span><br><span class="line">　　should：　　表示可以满足也可以不满足；</span><br><span class="line"></span><br><span class="line">　　must_not：　　表示不能满足该条件；</span><br><span class="line"></span><br><span class="line">　　minimum_should_match:1    ：表示最小匹配度，可以设置为百分之百，设置了这个值的时候就必须满足should里面的设置了，</span><br><span class="line"></span><br><span class="line">　　　　另外注意这边should里面同一字段设置的多个值，意思是当这个值等于X或者等于Y都成立，务必注意格式。</span><br></pre></td></tr></table></figure><h2><span id="es-pi-liang-de-cao-zuo">Es批量的操作</span><a href="#es-pi-liang-de-cao-zuo" class="header-anchor"></a></h2><ul><li>针对批量插入的限制: 一般建议是1000-5000个文档，大小建议是5-15MB，默认不能超过100M，可以在es的配置文件（即$ES_HOME下的config下的elasticsearch.yml）中</li></ul><ul><li>批量的查询(kibana操作)</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_mget</span><br><span class="line">&#123;</span><br><span class="line">  &quot;docs&quot;:</span><br><span class="line">  [</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;_index&quot;  :  &quot;db-1&quot;,</span><br><span class="line">        &quot;_type&quot;   :  &quot;tab-1&quot;,</span><br><span class="line">        &quot;_id&quot;    :  &quot;1&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">   &#123;</span><br><span class="line">        &quot;_index&quot;  :  &quot;db-1&quot;,</span><br><span class="line">        &quot;_type&quot;   :  &quot;tab-1&quot;,</span><br><span class="line">        &quot;_id&quot;    :  &quot;2&quot;</span><br><span class="line">    &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>批量查询 id 的集合的数据:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET db-1&#x2F;tab-1&#x2F;_mget</span><br><span class="line">&#123;</span><br><span class="line">  &quot;ids&quot;:[&quot;1&quot;,&quot;2&quot;,&quot;3&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>批量的增加: _bulk:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;db-1&#x2F;tab-1&#x2F;_bulk</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_id&quot;:1&#125;&#125;</span><br><span class="line">&#123;&quot;title&quot;:&quot;Java&quot;,&quot;price&quot;:55&#125;</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_id&quot;:2&#125;&#125;</span><br><span class="line">&#123;&quot;title&quot;:&quot;Html5&quot;,&quot;price&quot;:45&#125;</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_id&quot;:3&#125;&#125;</span><br><span class="line">&#123;&quot;title&quot;:&quot;Php&quot;,&quot;price&quot;:35&#125;</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_id&quot;:4&#125;&#125;</span><br><span class="line">&#123;&quot;title&quot;:&quot;Python&quot;,&quot;price&quot;:50&#125;</span><br></pre></td></tr></table></figure><h2><span id="es-he-xin-de-cao-zuo-huan-shi-cha-xun-cao-zuo-shi-yong-query-dsl-qing-qiu-cha-xun">Es 核心的操作还是查询操作: 使用query DSL 请求查询</span><a href="#es-he-xin-de-cao-zuo-huan-shi-cha-xun-cao-zuo-shi-yong-query-dsl-qing-qiu-cha-xun" class="header-anchor"></a></h2><ul><li>参考文章 :  <a href="https://www.cnblogs.com/liuqijia/p/11507494.html" target="_blank" rel="noopener">https://www.cnblogs.com/liuqijia/p/11507494.html</a> </li></ul><ul><li>match 分页查询:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET db-1&#x2F;tab-1&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">  &quot;match_all&quot; : &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>根据字段 age 的倒序的查询:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET db-1&#x2F;tab-1&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot; : &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;age&quot;: &quot;desc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>指定查询项 :  只查询出 content 的字段内容:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET db-1&#x2F;tab-1&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">  &quot;match_all&quot; : &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: &quot;content&quot;, </span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>matchAll 操作: 全查询 但显示仅仅是 5条记录</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">GET db-1&#x2F;tab-1&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">  &quot;match_all&quot; : &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">返回结果:  5条记录</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+ 过滤查询 : 匹配查询 cn-name &#x3D; ELK  </span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;text</span><br><span class="line"></span><br><span class="line">GET db-1&#x2F;tab-1&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;cn-name&quot;: &quot;ELK&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>全文检索:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET db-1&#x2F;tab-1&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;content&quot;: &quot;97&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li>短语检索:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET db-1&#x2F;tab-1&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase&quot;: &#123;</span><br><span class="line">      &quot;content&quot;: &quot; 内容  --&gt;9&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>复合查询:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">GET db-1&#x2F;tab-1&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;from&quot;: 10,</span><br><span class="line">  &quot;size&quot;: 20, </span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;age&quot;: &#123;</span><br><span class="line">        &quot;order&quot;: &quot;desc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ], </span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot; : &#123;</span><br><span class="line">    &quot;must&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;match&quot; : &#123;</span><br><span class="line">          &quot;content&quot; : &#123;</span><br><span class="line">            &quot;query&quot; : &quot; 内容&quot;,</span><br><span class="line">            &quot;operator&quot; : &quot;OR&quot;,</span><br><span class="line">            &quot;prefix_length&quot; : 0,</span><br><span class="line">            &quot;max_expansions&quot; : 50,</span><br><span class="line">            &quot;fuzzy_transpositions&quot; : true,</span><br><span class="line">            &quot;lenient&quot; : false,</span><br><span class="line">            &quot;zero_terms_query&quot; : &quot;NONE&quot;,</span><br><span class="line">            &quot;auto_generate_synonyms_phrase_query&quot; : true,</span><br><span class="line">            &quot;boost&quot; : 1.0</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;filter&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;range&quot; : &#123;</span><br><span class="line">          &quot;age&quot; : &#123;</span><br><span class="line">            &quot;from&quot; : &quot;5&quot;,</span><br><span class="line">            &quot;to&quot; : &quot;25&quot;,</span><br><span class="line">            &quot;include_lower&quot; : true,</span><br><span class="line">            &quot;include_upper&quot; : true,</span><br><span class="line">            &quot;boost&quot; : 1.0</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;must_not&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;term&quot; : &#123;</span><br><span class="line">          &quot;age&quot; : &#123;</span><br><span class="line">            &quot;value&quot; : &quot;90&quot;,</span><br><span class="line">            &quot;boost&quot; : 1.0</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;should&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;range&quot; : &#123;</span><br><span class="line">          &quot;age&quot; : &#123;</span><br><span class="line">            &quot;from&quot; : &quot;10&quot;,</span><br><span class="line">            &quot;to&quot; : &quot;20&quot;,</span><br><span class="line">            &quot;include_lower&quot; : true,</span><br><span class="line">            &quot;include_upper&quot; : true,</span><br><span class="line">            &quot;boost&quot; : 1.0</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;adjust_pure_negative&quot; : true,</span><br><span class="line">    &quot;boost&quot; : 1.0</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      docker 部署使用 ELk
    
    </summary>
    
    
      <category term="elk" scheme="https://zuoyoulai.github.io/categories/elk/"/>
    
    
      <category term="elk" scheme="https://zuoyoulai.github.io/tags/elk/"/>
    
      <category term="docker" scheme="https://zuoyoulai.github.io/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>mybatis-batch 批处理</title>
    <link href="https://zuoyoulai.github.io/2020/01/22/mybatis-batch/"/>
    <id>https://zuoyoulai.github.io/2020/01/22/mybatis-batch/</id>
    <published>2020-01-22T07:27:01.000Z</published>
    <updated>2020-01-22T07:40:34.345Z</updated>
    
    <content type="html"><![CDATA[<div class="toc"><!-- toc --><ul><li><a href="#pi-liang-chu-li-fang-shi">批量处理方式</a></li><li><a href="#yi-shang-3-chong-de-you-lie">以上3种的优劣:</a></li><li><a href="#li-zi-demo">例子demo</a></li></ul><!-- tocstop --></div><h3><span id="pi-liang-chu-li-fang-shi">批量处理方式</span><a href="#pi-liang-chu-li-fang-shi" class="header-anchor"></a></h3><ul><li>原生的JDBC  :  这种方式最快，代码比较麻烦</li><li>Mybatis 的 ExecutorType.BATCH ：代码编写比较简单，数据库连接需要添加allowMultiQueries=true</li><li>Mybatis 动态 sql拼接方式</li></ul><h3><span id="yi-shang-3-chong-de-you-lie">以上3种的优劣:</span><a href="#yi-shang-3-chong-de-you-lie" class="header-anchor"></a></h3><ul><li><a href="https://blog.csdn.net/qq_40144558/article/details/93981183" target="_blank" rel="noopener">参考文章: 关于Mybatis批量插入使用JDBC原生batch批处理以及mybatis的ExecutorType.BATCH的批处理和Mybatis的动态sql语句批处理</a></li></ul><h3><span id="li-zi-demo">例子demo</span><a href="#li-zi-demo" class="header-anchor"></a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  batch insert</span></span><br><span class="line"><span class="comment">     *  表数据准备</span></span><br><span class="line"><span class="comment">     *  create table `kt_1_trigger_logs` like  kt_merchant_id_trigger_logs;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  批量处理 : 添加 200w条数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batch</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SqlSession sqlSession = sqlSessionFactory.openSession(ExecutorType.BATCH);</span><br><span class="line"></span><br><span class="line">            SubMerchantIdTriggerLogsMapper subMerchantIdTriggerLogsMapper = (SubMerchantIdTriggerLogsMapper) sqlSession.getMapper(SubMerchantIdTriggerLogsMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">200</span>; j++) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">                    SubMerchantIdTriggerLogs logs = <span class="keyword">new</span> SubMerchantIdTriggerLogs();</span><br><span class="line">                    logs.setAppId(appId);</span><br><span class="line">                    logs.setMerchantId(merchantId);</span><br><span class="line"></span><br><span class="line">                    logs.setSdkType(test_str);</span><br><span class="line">                    logs.setSource(test_str);</span><br><span class="line">                    logs.setTriggeredAt(<span class="keyword">new</span> Date());</span><br><span class="line">                    logs.setUserid(Tools.getRandStr());</span><br><span class="line">                    logs.setDeviceid(Tools.getRandStr(<span class="number">5</span>));</span><br><span class="line">                    logs.setConditions(<span class="string">""</span>);</span><br><span class="line">                    <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                        logs.setIp(Tools.getRandStr(<span class="number">5</span>));</span><br><span class="line">                        logs.setUpdatedAt(<span class="keyword">new</span> Date());</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        logs.setIp(<span class="string">""</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    logs.setCreatedAt(<span class="keyword">new</span> Date());</span><br><span class="line">      </span><br><span class="line">                    subMerchantIdTriggerLogsMapper.insertSelective(logs);</span><br><span class="line">                &#125;</span><br><span class="line">                sqlSession.commit();</span><br><span class="line">            &#125;</span><br><span class="line">            sqlSession.close();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            log.error(ex.getMessage(), ex);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  batch update</span></span><br><span class="line"><span class="comment">     *  批量的 update 的操作 :  校验出，有些字段有有些没有的话则相应的更新的</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SqlSession sqlSession = sqlSessionFactory.openSession(ExecutorType.BATCH);</span><br><span class="line">            SubMerchantIdTriggerLogsMapper subMerchantIdTriggerLogsMapper = (SubMerchantIdTriggerLogsMapper) sqlSession.getMapper(SubMerchantIdTriggerLogsMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                SubMerchantIdTriggerLogs subMerchantIdTriggerLogs = <span class="keyword">new</span> SubMerchantIdTriggerLogs();</span><br><span class="line">                subMerchantIdTriggerLogs.setMerchantId(merchantId);</span><br><span class="line">                subMerchantIdTriggerLogs.setId(i);</span><br><span class="line">                <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                    subMerchantIdTriggerLogs.setIp(<span class="string">""</span>);</span><br><span class="line">                    subMerchantIdTriggerLogs.setSdkVersion(<span class="string">""</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                subMerchantIdTriggerLogs.setUpdatedAt(<span class="keyword">new</span> Date());</span><br><span class="line">                subMerchantIdTriggerLogsMapper.updateByPrimaryKeySelective(subMerchantIdTriggerLogs);</span><br><span class="line">            &#125;</span><br><span class="line">            sqlSession.commit();</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            log.error(ex.getMessage(), ex);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量更新后的操作断言</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateAfterDo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SqlSession sqlSession = sqlSessionFactory.openSession(ExecutorType.BATCH,Boolean.FALSE);</span><br><span class="line">            SubMerchantIdTriggerLogsMapper subMerchantIdTriggerLogsMapper = (SubMerchantIdTriggerLogsMapper) sqlSession.getMapper(SubMerchantIdTriggerLogsMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            List&lt;SubMerchantIdTriggerLogs&gt; list = Lists.newArrayList();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                SubMerchantIdTriggerLogs logs = <span class="keyword">new</span> SubMerchantIdTriggerLogs();</span><br><span class="line">                logs.setAppId(appId);</span><br><span class="line">                logs.setMerchantId(merchantId);</span><br><span class="line"></span><br><span class="line">                logs.setSdkType(test_str);</span><br><span class="line">                logs.setSource(test_str);</span><br><span class="line">                logs.setTriggeredAt(<span class="keyword">new</span> Date());</span><br><span class="line">                logs.setUserid(Tools.getRandStr());</span><br><span class="line">                logs.setDeviceid(Tools.getRandStr(<span class="number">5</span>));</span><br><span class="line">                logs.setConditions(<span class="string">""</span>);</span><br><span class="line">                <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                    logs.setIp(Tools.getRandStr(<span class="number">5</span>));</span><br><span class="line">                    logs.setUpdatedAt(<span class="keyword">new</span> Date());</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    logs.setIp(<span class="string">""</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                logs.setCreatedAt(<span class="keyword">new</span> Date());</span><br><span class="line">      </span><br><span class="line">                list.add(logs);</span><br><span class="line">                subMerchantIdTriggerLogsMapper.insertSelective(logs);</span><br><span class="line">            &#125;</span><br><span class="line">            sqlSession.commit();</span><br><span class="line">            <span class="comment">//刷新执行结果可以进行断言操作  [发现有无这个执行都可以拿到新增 insert data 的 id 的]</span></span><br><span class="line"><span class="comment">//            sqlSession.flushStatements();</span></span><br><span class="line">            <span class="comment">//清除缓存</span></span><br><span class="line"><span class="comment">//            sqlSession.clearCache();</span></span><br><span class="line">            sqlSession.close();</span><br><span class="line">            list.forEach(x-&gt;&#123;</span><br><span class="line">                log.info(JSON.toJSONString(x));</span><br><span class="line">            &#125;);</span><br><span class="line">            list.clear();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            log.error(ex.getMessage(), ex);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      mybatis-batch 批处理
    
    </summary>
    
    
      <category term="mybatis" scheme="https://zuoyoulai.github.io/categories/mybatis/"/>
    
    
      <category term="mybatis" scheme="https://zuoyoulai.github.io/tags/mybatis/"/>
    
      <category term="sql" scheme="https://zuoyoulai.github.io/tags/sql/"/>
    
  </entry>
  
  <entry>
    <title>运维Redis服务信息</title>
    <link href="https://zuoyoulai.github.io/2020/01/13/Redis%E6%9C%8D%E5%8A%A1%E4%BF%A1%E6%81%AF/"/>
    <id>https://zuoyoulai.github.io/2020/01/13/Redis%E6%9C%8D%E5%8A%A1%E4%BF%A1%E6%81%AF/</id>
    <published>2020-01-13T14:30:59.000Z</published>
    <updated>2020-01-13T14:38:45.897Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="yun-wei-redis-fu-wu-xin-xi">运维Redis服务信息</span><a href="#yun-wei-redis-fu-wu-xin-xi" class="header-anchor"></a></h2><div class="toc"><!-- toc --><ul><li><a href="#redis-dui-lie-xiao-fei-wen-ti">redis 队列消费问题</a><ul><li><a href="#shu-ju-biao-de-zhun-bei">数据表的准备</a></li><li><a href="#xi-tong-redis-pei-zhi">系统 redis 配置</a></li><li><a href="#redis-lian-jie-chi-ji-ben-pei-zhi-shuo-ming">redis 连接池基本配置说明</a></li><li><a href="#jin-ru-redis-de-rong-qi-de-zhi-ling-cao-zuo">进入 redis 的容器的指令操作</a></li></ul></li></ul><!-- tocstop --></div><h2><span id="redis-dui-lie-xiao-fei-wen-ti">redis 队列消费问题</span><a href="#redis-dui-lie-xiao-fei-wen-ti" class="header-anchor"></a></h2><ul><li>参考文章: <a href="https://mp.weixin.qq.com/s/4DYdDEHpiLs8aoW6y9k4Mw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/4DYdDEHpiLs8aoW6y9k4Mw</a></li></ul><h3><span id="shu-ju-biao-de-zhun-bei">数据表的准备</span><a href="#shu-ju-biao-de-zhun-bei" class="header-anchor"></a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table &#96;xx_tbl&#96; like  model_tbl;</span><br><span class="line"></span><br><span class="line">example:</span><br><span class="line"></span><br><span class="line">create table &#96;xx_tbl&#96; like  model_tbl;</span><br></pre></td></tr></table></figure><h3><span id="xi-tong-redis-pei-zhi">系统 redis 配置</span><a href="#xi-tong-redis-pei-zhi" class="header-anchor"></a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#rdb backup</span><br><span class="line">save 300 10</span><br><span class="line"></span><br><span class="line">#aof backup</span><br><span class="line">#是否开启持久化策略</span><br><span class="line">appendonly yes</span><br><span class="line"></span><br><span class="line">#yes: 在aof重写期间不做fsync刷盘操作，可能丢失整个AOF重写期间的数据</span><br><span class="line">no-appendfsync-on-rewrite  yes</span><br></pre></td></tr></table></figure><h3><span id="redis-lian-jie-chi-ji-ben-pei-zhi-shuo-ming">redis 连接池基本配置说明</span><a href="#redis-lian-jie-chi-ji-ben-pei-zhi-shuo-ming" class="header-anchor"></a></h3><ul><li>redis.pool.maxTotal=1000   :  最大活动对象数</li><li>redis.pool.maxIdle=100 最大能够保持idel状态的对象数</li><li>redis.pool.minIdle=50  最小能够保持idel状态的对象数</li></ul><h3><span id="jin-ru-redis-de-rong-qi-de-zhi-ling-cao-zuo">进入 redis 的容器的指令操作</span><a href="#jin-ru-redis-de-rong-qi-de-zhi-ling-cao-zuo" class="header-anchor"></a></h3><ul><li><p>docker ps</p></li><li><p>docker exec -it [containerid] /bin/bash</p></li><li><p>docker exec -it [containerid] redis-cli -a root </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">docker exec -it 77ae redis-cli</span><br><span class="line">进入指令窗口,进行 root 操作:</span><br><span class="line">&gt;&gt; auth [your password]</span><br><span class="line"></span><br><span class="line">进入指令操作:</span><br><span class="line">docker exec -it 77ae redis-cli -a root</span><br></pre></td></tr></table></figure></li><li><p>监控redis的磁盘使用情况与 clients 的连接数: redis-cli –stat -i 10</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; docker exec -it 77ae redis-cli -a root --stat -i 10   [不安全的写法,因为密码写在明文上]</span><br><span class="line"></span><br><span class="line">打出指令进行监控的操作,定时的刷出日志内容:  【单位是: 10s】</span><br><span class="line"></span><br><span class="line">------- data ------ --------------------- load -------------------- - child -</span><br><span class="line">keys       mem      clients blocked requests            connections          </span><br><span class="line">11         5.55M    3       0       312130 (+917)       690</span><br></pre></td></tr></table></figure></li><li><p>查看 redis 某个节点的网络延迟: redis-cli –latentcy  -h 127.0.0.1</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; docker exec -it 77ae redis-cli -a root --latency -h 127.0.0.1</span><br><span class="line"></span><br><span class="line">min: 0, max: 7, avg: 0.25 (15009 samples)</span><br><span class="line"></span><br><span class="line">avg：0.25，即延迟为250μs。如果通过外网连接网络延迟会很高，比如跨机房的redis调用，延迟高的情况下使用redis反而比使用本地硬盘读写性能更差</span><br></pre></td></tr></table></figure></li></ul><h4><span id="ming-ling-zhi-ling">命令指令</span><a href="#ming-ling-zhi-ling" class="header-anchor"></a></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">key &#x3D;  trigger_log_list</span><br><span class="line"></span><br><span class="line">查看链表的长度:</span><br><span class="line">&gt;&gt; llen trigger_log_list</span><br><span class="line"></span><br><span class="line">查看链表的数据:</span><br><span class="line">&gt;&gt; lrange trigger_log_list 0 10</span><br></pre></td></tr></table></figure><h4><span id="jian-kong-de-zhi-ling-cao-zuo">监控的指令操作</span><a href="#jian-kong-de-zhi-ling-cao-zuo" class="header-anchor"></a></h4><ul><li>查看 redis 当前的连接数 : info clients</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Clients</span><br><span class="line">connected_clients:12</span><br><span class="line">client_recent_max_input_buffer:2</span><br><span class="line">client_recent_max_output_buffer:0</span><br><span class="line">blocked_clients:0</span><br><span class="line">&#96;&#96;&#96; </span><br><span class="line"></span><br><span class="line">+ 查询redis允许的最大连接数 : config get maxclients</span><br><span class="line">&#96;&#96;&#96;text</span><br><span class="line">1) &quot;maxclients&quot;</span><br><span class="line">2) &quot;10000&quot;</span><br></pre></td></tr></table></figure><ul><li><p>每秒处理的命令数:  info stats</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; info stats</span><br><span class="line"># Stats</span><br><span class="line">total_connections_received:1</span><br><span class="line">total_commands_processed:2</span><br><span class="line">instantaneous_ops_per_sec:0</span><br><span class="line">total_net_input_bytes:129</span><br><span class="line">total_net_output_bytes:135</span><br><span class="line">instantaneous_input_kbps:0.00</span><br><span class="line">instantaneous_output_kbps:0.00</span><br><span class="line">rejected_connections:0</span><br><span class="line">sync_full:0</span><br><span class="line">sync_partial_ok:0</span><br><span class="line">sync_partial_err:0</span><br><span class="line">expired_keys:313904035720</span><br><span class="line">expired_stale_perc:0.00</span><br><span class="line">expired_time_cap_reached_count:0</span><br><span class="line">evicted_keys:0</span><br><span class="line">keyspace_hits:1</span><br><span class="line">keyspace_misses:0</span><br><span class="line">pubsub_channels:0</span><br><span class="line">pubsub_patterns:0</span><br><span class="line">latest_fork_usec:0</span><br><span class="line">migrate_cached_sockets:0</span><br><span class="line">slave_expires_tracked_keys:0</span><br><span class="line">active_defrag_hits:0</span><br><span class="line">active_defrag_misses:0</span><br><span class="line">active_defrag_key_hits:0</span><br><span class="line">active_defrag_key_misses:0</span><br></pre></td></tr></table></figure></li><li><p>慢日志的查询 :  slowlog get  可通过config set slowlog-log-slower-than xxx修改慢查询时间，单位微秒，默认情况下，这个值为10000</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; slowlog get</span><br><span class="line">1) 1) (integer) 0</span><br><span class="line">   2) (integer) 1578658649</span><br><span class="line">   3) (integer) 15696</span><br><span class="line">   4) 1) &quot;LRANGE&quot;</span><br><span class="line">      2) &quot;trigger_log_list_0&quot;</span><br><span class="line">      3) &quot;0&quot;</span><br><span class="line">      4) &quot;999&quot;</span><br><span class="line">   5) &quot;172.17.0.1:51742&quot;</span><br><span class="line">   6) &quot;&quot;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      运维Redis服务信息
    
    </summary>
    
    
      <category term="Redis" scheme="https://zuoyoulai.github.io/categories/Redis/"/>
    
    
      <category term="Docker" scheme="https://zuoyoulai.github.io/tags/Docker/"/>
    
      <category term="Redis" scheme="https://zuoyoulai.github.io/tags/Redis/"/>
    
      <category term="运维" scheme="https://zuoyoulai.github.io/tags/%E8%BF%90%E7%BB%B4/"/>
    
  </entry>
  
  <entry>
    <title>线上系统运行信息查看 shell 脚本</title>
    <link href="https://zuoyoulai.github.io/2020/01/09/%E7%BA%BF%E4%B8%8A%E7%B3%BB%E7%BB%9F%E8%BF%90%E8%A1%8C%E4%BF%A1%E6%81%AF%E6%9F%A5%E7%9C%8B/"/>
    <id>https://zuoyoulai.github.io/2020/01/09/%E7%BA%BF%E4%B8%8A%E7%B3%BB%E7%BB%9F%E8%BF%90%E8%A1%8C%E4%BF%A1%E6%81%AF%E6%9F%A5%E7%9C%8B/</id>
    <published>2020-01-09T10:41:03.000Z</published>
    <updated>2020-01-09T10:53:20.669Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="xian-shang-xi-tong-yun-xing-xin-xi-cha-kan-shell-jiao-ben">线上系统运行信息查看 shell 脚本</span><a href="#xian-shang-xi-tong-yun-xing-xin-xi-cha-kan-shell-jiao-ben" class="header-anchor"></a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">project_path&#x3D;&quot;&#x2F;Users&#x2F;haodalai&#x2F;go&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;显示系统磁盘分布情况&quot;</span><br><span class="line">echo &quot;&quot;</span><br><span class="line">df -h</span><br><span class="line"></span><br><span class="line">echo &quot;&quot;</span><br><span class="line">echo &quot;&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;显示文件或目录占用情况&quot;</span><br><span class="line">echo &quot;&quot;</span><br><span class="line">du -sh $project_path</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      线上系统运行信息查看 shell 脚本
    
    </summary>
    
    
      <category term="Linux" scheme="https://zuoyoulai.github.io/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://zuoyoulai.github.io/tags/Linux/"/>
    
      <category term="Shell" scheme="https://zuoyoulai.github.io/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>每天学习一个 Linux 指令 - du 与 df 指令</title>
    <link href="https://zuoyoulai.github.io/2020/01/09/Linux-Du-Df/"/>
    <id>https://zuoyoulai.github.io/2020/01/09/Linux-Du-Df/</id>
    <published>2020-01-09T06:28:10.000Z</published>
    <updated>2020-01-09T10:39:59.858Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="linux-de-du-yu-df-zhi-ling">Linux的 du 与 df 指令</span><a href="#linux-de-du-yu-df-zhi-ling" class="header-anchor"></a></h2><div class="toc"><!-- toc --><ul><li><a href="#df-zhi-ling">df 指令</a></li><li><a href="#du-zhi-ling">du 指令</a></li></ul><!-- tocstop --></div><h3><span id="df-zhi-ling">df 指令</span><a href="#df-zhi-ling" class="header-anchor"></a></h3><ul><li>df命令用于显示目前在Linux系统上的文件系统的磁盘使用情况统计</li><li>格式 : df [选项]… [FILE]…</li><li>经常使用: df -h</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">文件-a, --all 包含所有的具有 0 Blocks 的文件系统</span><br><span class="line"></span><br><span class="line">文件--block-size&#x3D;&#123;SIZE&#125; 使用 &#123;SIZE&#125; 大小的 Blocks</span><br><span class="line"></span><br><span class="line">文件-h, --human-readable 使用人类可读的格式(预设值是不加这个选项的...)</span><br><span class="line"></span><br><span class="line">文件-H, --si 很像 -h, 但是用 1000 为单位而不是用 1024</span><br><span class="line"></span><br><span class="line">文件-i, --inodes 列出 inode 资讯，不列出已使用 block</span><br><span class="line"></span><br><span class="line">文件-k, --kilobytes 就像是 --block-size&#x3D;1024</span><br><span class="line"></span><br><span class="line">文件-l, --local 限制列出的文件结构</span><br><span class="line"></span><br><span class="line">文件-m, --megabytes 就像 --block-size&#x3D;1048576</span><br><span class="line"></span><br><span class="line">文件--no-sync 取得资讯前不 sync (预设值)</span><br><span class="line"></span><br><span class="line">文件-P, --portability 使用 POSIX 输出格式</span><br><span class="line"></span><br><span class="line">文件--sync 在取得资讯前 sync</span><br><span class="line"></span><br><span class="line">文件-t, --type&#x3D;TYPE 限制列出文件系统的 TYPE</span><br><span class="line"></span><br><span class="line">文件-T, --print-type 显示文件系统的形式</span><br><span class="line"></span><br><span class="line">文件-x, --exclude-type&#x3D;TYPE 限制列出文件系统不要显示 TYPE</span><br><span class="line"></span><br><span class="line">文件-v (忽略)</span><br><span class="line"></span><br><span class="line">文件--help 显示这个帮手并且离开</span><br><span class="line"></span><br><span class="line">文件--version 输出版本资讯并且离开</span><br></pre></td></tr></table></figure><h3><span id="du-zhi-ling">du 指令</span><a href="#du-zhi-ling" class="header-anchor"></a></h3><ul><li>du命令用于显示文件或目录所占用的磁盘空间</li><li>格式 : du [option] 文件/目录</li><li>常用 :<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">du -sh xxx  显示总目录的大小，但是不会列出目录中的每一个文件</span><br><span class="line">du -sh xxx&#x2F;*  列出xxx下每个目录和文件所占的容量</span><br><span class="line">du -h --max-depth&#x3D;1  Linux 查找占用空间最大的文件与目录</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-a或-all 显示目录中个别文件的大小。</span><br><span class="line"></span><br><span class="line">-b或-bytes 显示目录或文件大小时，以byte为单位。</span><br><span class="line"></span><br><span class="line">-c或--total 除了显示个别目录或文件的大小外，同时也显示所有目录或文件的总和。</span><br><span class="line"></span><br><span class="line">-D或--dereference-args 显示指定符号连接的源文件大小。</span><br><span class="line"></span><br><span class="line">-h或--human-readable 以K，M，G为单位，提高信息的可读性。</span><br><span class="line"></span><br><span class="line">-H或--si 与-h参数相同，但是K，M，G是以1000为换算单位。</span><br><span class="line"></span><br><span class="line">-k或--kilobytes 以1024 bytes为单位。</span><br><span class="line"></span><br><span class="line">-l或--count-links 重复计算硬件连接的文件。</span><br><span class="line"></span><br><span class="line">-L&lt;符号连接&gt;或--dereference&lt;符号连接&gt; 显示选项中所指定符号连接的源文件大小。</span><br><span class="line"></span><br><span class="line">-m或--megabytes 以1MB为单位。</span><br><span class="line"></span><br><span class="line">-s或--summarize 仅显示总计。</span><br><span class="line"></span><br><span class="line">-S或--separate-dirs 显示个别目录的大小时，并不含其子目录的大小。</span><br><span class="line"></span><br><span class="line">-x或--one-file-xystem 以一开始处理时的文件系统为准，若遇上其它不同的文件系统目录则略过。</span><br><span class="line"></span><br><span class="line">-X&lt;文件&gt;或--exclude-from&#x3D;&lt;文件&gt; 在&lt;文件&gt;指定目录或文件。</span><br><span class="line"></span><br><span class="line">--exclude&#x3D;&lt;目录或文件&gt; 略过指定的目录或文件。</span><br><span class="line"></span><br><span class="line">--max-depth&#x3D;&lt;目录层数&gt; 超过指定层数的目录后，予以忽略。</span><br><span class="line"></span><br><span class="line">--help 显示帮助。</span><br><span class="line"></span><br><span class="line">--version 显示版本信息</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      每天学习一个 Linux 指令 - du 与 df 指令
    
    </summary>
    
    
      <category term="Linux" scheme="https://zuoyoulai.github.io/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://zuoyoulai.github.io/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>优秀 GitHub 资源</title>
    <link href="https://zuoyoulai.github.io/2020/01/08/Good-GitHub/"/>
    <id>https://zuoyoulai.github.io/2020/01/08/Good-GitHub/</id>
    <published>2020-01-08T09:52:20.000Z</published>
    <updated>2020-01-09T06:13:54.576Z</updated>
    
    <content type="html"><![CDATA[<div class="toc"><!-- toc --><ul><li><a href="#you-xiu-github-zi-yuan">优秀 GitHub 资源</a><ul><li><a href="#java-xiang-guan">Java 相关</a></li><li><a href="#linux-xiang-guan">Linux 相关</a></li><li><a href="#go-xiang-guan">Go 相关</a></li></ul></li></ul><!-- tocstop --></div>## 优秀 GitHub 资源<h3><span id="java-xiang-guan">Java 相关</span><a href="#java-xiang-guan" class="header-anchor"></a></h3><table><thead><tr><th>名称</th><th>Url</th></tr></thead><tbody><tr><td>架构师知识</td><td><a href="https://doocs.github.io/advanced-java/" target="_blank" rel="noopener">https://doocs.github.io/advanced-java/</a></td></tr><tr><td>大数据笔记</td><td><a href="https://github.com/heibaiying/BigData-Notes?utm_source=gold_browser_extension" target="_blank" rel="noopener">https://github.com/heibaiying/BigData-Notes?utm_source=gold_browser_extension</a></td></tr><tr><td>分布式任务调度 xxl-job</td><td><a href="https://github.com/xuxueli/xxl-job?utm_source=gold_browser_extension" target="_blank" rel="noopener">https://github.com/xuxueli/xxl-job?utm_source=gold_browser_extension</a></td></tr></tbody></table><h3><span id="linux-xiang-guan">Linux 相关</span><a href="#linux-xiang-guan" class="header-anchor"></a></h3><table><thead><tr><th>名称</th><th>Url</th></tr></thead></table><h3><span id="go-xiang-guan">Go 相关</span><a href="#go-xiang-guan" class="header-anchor"></a></h3><table><thead><tr><th>名称</th><th>Url</th></tr></thead><tbody><tr><td>go学习系列文章</td><td><a href="https://www.liwenzhou.com/categories/Golang/" target="_blank" rel="noopener">https://www.liwenzhou.com/categories/Golang/</a></td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      优秀 GitHub 资源
    
    </summary>
    
    
      <category term="GitHub" scheme="https://zuoyoulai.github.io/categories/GitHub/"/>
    
    
      <category term="学习文章" scheme="https://zuoyoulai.github.io/tags/%E5%AD%A6%E4%B9%A0%E6%96%87%E7%AB%A0/"/>
    
      <category term="GitHub" scheme="https://zuoyoulai.github.io/tags/GitHub/"/>
    
  </entry>
  
  <entry>
    <title>Go语言之 BeeGo 学习</title>
    <link href="https://zuoyoulai.github.io/2020/01/07/Go-BeeGo/"/>
    <id>https://zuoyoulai.github.io/2020/01/07/Go-BeeGo/</id>
    <published>2020-01-07T15:07:43.000Z</published>
    <updated>2020-01-25T14:27:26.417Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="go-yu-yan-zhi-beego-xue-xi">Go语言之 BeeGo 学习</span><a href="#go-yu-yan-zhi-beego-xue-xi" class="header-anchor"></a></h2><div class="toc"><!-- toc --><ul><li><a href="#gopm-an-zhuang-cao-zuo">Gopm 安装操作</a></li></ul><!-- tocstop --></div><h3><span id="gopm-an-zhuang-cao-zuo">Gopm 安装操作</span><a href="#gopm-an-zhuang-cao-zuo" class="header-anchor"></a></h3><ul><li>go get -v github.com/gpmgo/gopm 没有反应,需要修改</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Mac 修改 host:</span><br><span class="line">&gt;&gt; sudo vi &#x2F;etc&#x2F;hosts</span><br><span class="line"></span><br><span class="line">添加内容:</span><br><span class="line"></span><br><span class="line">192.30.253.112 github.com</span><br><span class="line">151.101.185.194 github.global.ssl.fastly.net</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wq 退出</span><br></pre></td></tr></table></figure><ul><li>下载完之后可以执行 gopm get 来替代 go get 的操作:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">gopm get  -g -v github.com&#x2F;astaxie&#x2F;beego</span><br><span class="line">go get -v github.com&#x2F;astaxie&#x2F;beego</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gopm get -g -v github.com&#x2F;beego&#x2F;bee</span><br><span class="line">gopm get -g -v golang.org&#x2F;x&#x2F;net</span><br><span class="line">go get  -v golang.org&#x2F;x&#x2F;net</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">go get github.com&#x2F;beego&#x2F;bee</span><br><span class="line">go get -v github.com&#x2F;beego&#x2F;bee</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">go get -u  -v github.com&#x2F;kataras&#x2F;iris</span><br><span class="line"></span><br><span class="line">go get -u  -v github.com&#x2F;gin-gonic&#x2F;gin</span><br><span class="line"></span><br><span class="line">gopm get -v github.com&#x2F;kataras&#x2F;iris</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">go get -v github.com&#x2F;hyper-carrot&#x2F;go_lib&#x2F;logging</span><br><span class="line">go get -v github.com&#x2F;astaxie&#x2F;beego</span><br><span class="line">go get -v golang.org&#x2F;x&#x2F;net</span><br></pre></td></tr></table></figure><ul><li>发现以上的方式，访问 github.com 还是很慢，所以得修改成另外一种方式:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;www.github.com&#x2F;hunterhug&#x2F;rabbit</span><br><span class="line">mkdir -p %GOPATH%&#x2F;src&#x2F;github.com&#x2F;hunterhug</span><br><span class="line">mv rabbit %GOPATH%&#x2F;src&#x2F;github.com&#x2F;hunterhug</span><br></pre></td></tr></table></figure></li></ul><ul><li>修改 host 文件的内容，提高访问 github.com 的项目<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Mac 修改 host:</span><br><span class="line">&gt;&gt; sudo vi &#x2F;etc&#x2F;hosts</span><br><span class="line"></span><br><span class="line">添加内容:</span><br><span class="line"></span><br><span class="line">#github</span><br><span class="line">192.30.253.112 github.com</span><br><span class="line">192.30.253.120 codeload.github.com</span><br><span class="line">219.76.4.4 github-cloud.s3.amazonaws.com</span><br><span class="line">151.101.185.194 github.global.ssl.fastly.net</span><br><span class="line">151.101.24.133 assets-cdn.github.com</span><br><span class="line">151.101.196.133 avatars0.githubusercontent.com</span><br><span class="line">151.101.196.133 avatars1.githubusercontent.com</span><br><span class="line">103.245.222.133 assets-cdn.github.com</span><br><span class="line">204.232.175.78 documentcloud.github.com</span><br><span class="line">204.232.175.94 gist.github.com</span><br><span class="line">107.21.116.220 help.github.com</span><br><span class="line">207.97.227.252 nodeload.github.com</span><br><span class="line">199.27.76.130 raw.github.com</span><br><span class="line">107.22.3.110 status.github.com</span><br><span class="line">204.232.175.78 training.github.com</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      BeeGo 开始学习
    
    </summary>
    
    
      <category term="Go" scheme="https://zuoyoulai.github.io/categories/Go/"/>
    
    
      <category term="Go" scheme="https://zuoyoulai.github.io/tags/Go/"/>
    
      <category term="BeeGo" scheme="https://zuoyoulai.github.io/tags/BeeGo/"/>
    
  </entry>
  
  <entry>
    <title>Linux 用户权限权限管理</title>
    <link href="https://zuoyoulai.github.io/2020/01/02/Linux-authority/"/>
    <id>https://zuoyoulai.github.io/2020/01/02/Linux-authority/</id>
    <published>2020-01-02T08:29:54.000Z</published>
    <updated>2020-01-02T15:47:40.596Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="linux-yong-hu-quan-xian-quan-xian-guan-li">Linux 用户权限权限管理</span><a href="#linux-yong-hu-quan-xian-quan-xian-guan-li" class="header-anchor"></a></h2><div class="toc"><!-- toc --><ul><li><a href="#chuang-jian-xin-yong-hu">创建新用户</a></li><li><a href="#yong-hu-dui-wen-jian-jia-wen-jian-cao-zuo-quan-xian">用户对文件夹,文件操作权限</a></li><li><a href="#li-zi-fu-yu-suo-you-zhe-hou-shan-chu-wen-jian-ze-quan-xian-bu-gou">例子 : 赋予所有者后删除文件则权限不够</a></li><li><a href="#li-zi-wu-mi-deng-lu-samlai-de-pu-tong-zhang-hao">例子 : 无秘登录 samlai 的普通账号</a></li></ul><!-- tocstop --></div><h3><span id="chuang-jian-xin-yong-hu">创建新用户</span><a href="#chuang-jian-xin-yong-hu" class="header-anchor"></a></h3><ul><li>以 root 用户为创建的基础</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1.创建新的用户,名称为:samlai</span><br><span class="line">&gt;&gt;  useradd samlai</span><br><span class="line"></span><br><span class="line">2.添加 samlai 密码:</span><br><span class="line">&gt;&gt;  passwd samlai</span><br><span class="line">&gt;&gt;</span><br><span class="line">    更改用户 samlai 的密码 。</span><br><span class="line">    新的 密码：</span><br><span class="line">    重新输入新的 密码：</span><br><span class="line">    passwd：所有的身份验证令牌已经成功更新</span><br><span class="line">    </span><br><span class="line">    laihaoda123</span><br><span class="line">&gt;&gt;</span><br><span class="line"></span><br><span class="line">3.切换到 samlai 用户:</span><br><span class="line">&gt;&gt; su samlai</span><br><span class="line"></span><br><span class="line">4.切换到 root 再进行修改 samlai 的密码</span><br><span class="line">&gt;&gt; su</span><br><span class="line">&gt;&gt; passwd samlai</span><br></pre></td></tr></table></figure><h3><span id="yong-hu-dui-wen-jian-jia-wen-jian-cao-zuo-quan-xian">用户对文件夹,文件操作权限</span><a href="#yong-hu-dui-wen-jian-jia-wen-jian-cao-zuo-quan-xian" class="header-anchor"></a></h3><ul><li>权限的说明:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-rw-rw-r-- 1 root root 22 1月   2 22:41 one.sh</span><br><span class="line"></span><br><span class="line">首字母类型:</span><br><span class="line">- : 文件</span><br><span class="line">d : 文件夹</span><br><span class="line">l : 链接</span><br><span class="line"></span><br><span class="line">后面9位字母代表:</span><br><span class="line">    r:4</span><br><span class="line">    w:2</span><br><span class="line">    x:1</span><br><span class="line"></span><br><span class="line">-rw(所属用户：root 权限)-rw(所属组: root 权限)r--(其他用户的权限)</span><br></pre></td></tr></table></figure><ul><li>修改权限操作:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod u+x one.txt  对所属用户添加权限</span><br><span class="line">chmod g+w,o+w  one.txt  对所属组，其他用户添加写的权限</span><br></pre></td></tr></table></figure><ul><li>权限对文件的作用</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">r :  cat more head tail</span><br><span class="line">w :  vi echo  [注意:不包括删除文件]</span><br><span class="line">x :  可执行 </span><br><span class="line"></span><br><span class="line">[对文件来说可执行是最高的权限]</span><br></pre></td></tr></table></figure><ul><li>权限对目录的左右</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">r : ls</span><br><span class="line">w : touch rm mv cp [这里文件夹的写权限就可以针对于文件删除的操作]</span><br><span class="line">x : 可以进入目录 cd</span><br><span class="line"></span><br><span class="line">[对文件来说写操作是最高的权限]</span><br></pre></td></tr></table></figure><ul><li>修改文件的所有者:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">chown laihaoda one.txt</span><br></pre></td></tr></table></figure><ul><li>修改文件的所属组:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">chgrp samlai one.txt</span><br></pre></td></tr></table></figure><ul><li>查看默认权限命令</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">umask</span><br></pre></td></tr></table></figure><h3><span id="li-zi-fu-yu-suo-you-zhe-hou-shan-chu-wen-jian-ze-quan-xian-bu-gou">例子 : 赋予所有者后删除文件则权限不够</span><a href="#li-zi-fu-yu-suo-you-zhe-hou-shan-chu-wen-jian-ze-quan-xian-bu-gou" class="header-anchor"></a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt;&gt; su </span><br><span class="line">&gt;&gt; ll</span><br><span class="line">总用量 4.0K</span><br><span class="line">-rwxrwxr-x 2 root root 4.0K 1月   2 22:41 one.sh</span><br><span class="line">&gt;&gt; chown samlai .&#x2F;one.sh</span><br><span class="line">&gt;&gt; ll</span><br><span class="line">总用量 4.0K</span><br><span class="line">-rw-rw-r-- 1 samlai root 22 1月   2 22:41 one.sh</span><br><span class="line">&gt;&gt; su samlai</span><br><span class="line">&gt;&gt; rm -rf one.sh</span><br><span class="line">rm: 无法删除&quot;one.sh&quot;: 权限不够</span><br><span class="line"></span><br><span class="line">[即使是所属者都无法删除权限，问题就是在于 : 文件所在的文件夹并不属于 samlai 根本原因: 文件夹与文件在分区的时候，是分开来,文件夹</span><br><span class="line">则管理着文件夹与其对应的文件名称,个数等之类。但所属者仅仅有对文件全部全部行为，除了删除。]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt;&gt; su </span><br><span class="line">把对应的文件夹所属者改成 samlai</span><br><span class="line">&gt;&gt; chown samlai ..&#x2F;one</span><br><span class="line">&gt;&gt; ll</span><br><span class="line">总用量 4.0K</span><br><span class="line">drwxrwxr-x 2 samlai root 4.0K 1月   2 22:41 one</span><br><span class="line">&gt;&gt; su samlai</span><br><span class="line">&gt;&gt; rm -rf one.sh</span><br><span class="line">这样就可以成功的删除了</span><br></pre></td></tr></table></figure><h3><span id="li-zi-wu-mi-deng-lu-samlai-de-pu-tong-zhang-hao">例子 : 无秘登录 samlai 的普通账号</span><a href="#li-zi-wu-mi-deng-lu-samlai-de-pu-tong-zhang-hao" class="header-anchor"></a></h3><ul><li>参考链接 : <a href="https://blog.csdn.net/lizhiyuan_eagle/article/details/80494512" target="_blank" rel="noopener">https://blog.csdn.net/lizhiyuan_eagle/article/details/80494512</a></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">A机器无密登录 B 机器的操作: ssh root@ipAddress</span><br><span class="line"></span><br><span class="line">2台机器 A 本地   B 远程:</span><br><span class="line"></span><br><span class="line">In A机器：</span><br><span class="line">1.yum install ssh</span><br><span class="line">2.ssh-keygen -t rsa -C &quot;472023527@qq.com&quot;</span><br><span class="line">3.cat ~&#x2F;.ssh&#x2F;id_rsa.pub    &#x2F;&#x2F; id_rsa是私钥</span><br><span class="line"></span><br><span class="line">将这个公钥给机器 B 中</span><br><span class="line"></span><br><span class="line">In B机器命令:</span><br><span class="line"># touch &#x2F;home&#x2F;samlai&#x2F;.ssh&#x2F;authorized_keys (如果已经存在这个文件, 跳过这条)</span><br><span class="line"></span><br><span class="line">[新的用户: 没有 .ssh 目录 则需要创建]</span><br><span class="line"></span><br><span class="line">&gt;&gt; mkdir ~&#x2F;.ssh</span><br><span class="line"></span><br><span class="line"># cat &#x2F;home&#x2F;samlai&#x2F;.ssh&#x2F;id_rsa.pub &gt;&gt; &#x2F;home&#x2F;samlai&#x2F;.ssh&#x2F;authorized_keys (将id_rsa.pub的内容追加到authorized_keys 中)</span><br><span class="line"></span><br><span class="line">samalai&#x2F;.ssh和authorized_keys的权限</span><br><span class="line"></span><br><span class="line">#chmod 700 samlai</span><br><span class="line"></span><br><span class="line">#chmod 700 .ssh</span><br><span class="line"></span><br><span class="line">#chmod 600 authorized_keys</span><br><span class="line"></span><br><span class="line">回到A机器:</span><br><span class="line"># ssh samlai@192.168.60.110 (不需要密码, 登录成功)</span><br><span class="line"></span><br><span class="line">测试成功！！！</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Linux 用户权限权限管理
    
    </summary>
    
    
      <category term="Linux" scheme="https://zuoyoulai.github.io/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://zuoyoulai.github.io/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Go 指针,数组,切片,Map</title>
    <link href="https://zuoyoulai.github.io/2020/01/02/Go-Struct1/"/>
    <id>https://zuoyoulai.github.io/2020/01/02/Go-Struct1/</id>
    <published>2020-01-02T02:25:02.000Z</published>
    <updated>2020-01-02T02:36:57.846Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="go-zhi-zhen-shu-zu-qie-pian-map">Go 指针,数组,切片,Map</span><a href="#go-zhi-zhen-shu-zu-qie-pian-map" class="header-anchor"></a></h2><div class="toc"><!-- toc --><ul><li><a href="#zhi-zhen">指针</a></li><li><a href="#shu-zu">数组</a></li><li><a href="#qie-pian-slice">切片: slice</a></li><li><a href="#map">Map</a></li></ul><!-- tocstop --></div><blockquote><p>Go 引用的方式只有一种 : 值传递</p></blockquote><h3><span id="zhi-zhen">指针</span><a href="#zhi-zhen" class="header-anchor"></a></h3><ul><li>Go语言的指针是不能进行运算的</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">Go 指针:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">1.值,引用传递:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  值: 值进行拷贝</span></span><br><span class="line"><span class="comment">  引入: 地址的引用</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">2.Go 引用的方式只有一种 : 值传递</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">a,b :=<span class="number">1</span>, <span class="number">100</span></span><br><span class="line">swap(&amp;a, &amp;b)</span><br><span class="line">fmt.Printf(<span class="string">"指针打印的 swap : a = %d  b = %d\n"</span>,a,b)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">d,c :=<span class="number">9</span>, <span class="number">88</span></span><br><span class="line">d,c =swapK(d, c)</span><br><span class="line">fmt.Printf(<span class="string">"返回多个值 swap :  d = %d  c = %d\n"</span>,d,c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">打印:</span></span><br><span class="line"><span class="comment">指针打印的 swap : a = 100  b = 1</span></span><br><span class="line"><span class="comment">返回多个值 swap :  d = 9  c = 88</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">指针操作的2数互换</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swap</span><span class="params">(a,b *<span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">*a,*b=*b,*a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swapK</span><span class="params">(a,b <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> b, a</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="shu-zu">数组</span><a href="#shu-zu" class="header-anchor"></a></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">数组：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">1. 定义数组</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">2. 遍历数组</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">3. range 遍历</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">4. 数组是值类型: 值拷贝</span></span><br><span class="line"><span class="comment">       在数组进行轮询的时候对某些角标值修改值的时候,因为数组是类型,是值拷贝,不会影响数组原来的值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   如果需要引用的话,可以加指针操作</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">5. go语言一般不使用数组,是切片</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义</span></span><br><span class="line"><span class="keyword">var</span> arr1 [<span class="number">5</span>]<span class="keyword">int</span></span><br><span class="line">arr2 := [<span class="number">3</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">arr3 := [...]<span class="keyword">int</span>&#123;<span class="number">10</span>, <span class="number">21</span>, <span class="number">33</span>, <span class="number">49</span>, <span class="number">54</span>&#125;</span><br><span class="line"><span class="keyword">var</span> grid [<span class="number">4</span>][<span class="number">5</span>]<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PrintArr(arr1)</span><br><span class="line"></span><br><span class="line">PrintArr(arr3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//打印内容</span></span><br><span class="line">fmt.Println(arr1,<span class="string">"  "</span>,arr2,<span class="string">"  "</span>, arr3,<span class="string">"  "</span>, grid)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//使用 range 打印 index value</span></span><br><span class="line"><span class="keyword">for</span> i,v:=<span class="keyword">range</span> arr3 &#123;</span><br><span class="line">fmt.Println(i, v)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">"\n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果只需要值的可以这样遍历</span></span><br><span class="line"><span class="keyword">for</span> _,v:=<span class="keyword">range</span> arr3 &#123;</span><br><span class="line">fmt.Println(v)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">打印结果:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">100</span></span><br><span class="line"><span class="comment">0</span></span><br><span class="line"><span class="comment">0</span></span><br><span class="line"><span class="comment">0</span></span><br><span class="line"><span class="comment">0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">100</span></span><br><span class="line"><span class="comment">21</span></span><br><span class="line"><span class="comment">33</span></span><br><span class="line"><span class="comment">49</span></span><br><span class="line"><span class="comment">54</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">[0 0 0 0 0]    [1 2 3]    [10 21 33 49 54]    [[0 0 0 0 0] [0 0 0 0 0] [0 0 0 0 0] [0 0 0 0 0]]</span></span><br><span class="line"><span class="comment">0 10</span></span><br><span class="line"><span class="comment">1 21</span></span><br><span class="line"><span class="comment">2 33</span></span><br><span class="line"><span class="comment">3 49</span></span><br><span class="line"><span class="comment">4 54</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">10</span></span><br><span class="line"><span class="comment">21</span></span><br><span class="line"><span class="comment">33</span></span><br><span class="line"><span class="comment">49</span></span><br><span class="line"><span class="comment">54</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">PrintArr</span><span class="params">(arr [5]<span class="keyword">int</span>)</span></span>  &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i:=<span class="keyword">range</span> arr &#123;</span><br><span class="line"><span class="comment">//数组是值传递 即使修改了值也改变不了原来的数组内容</span></span><br><span class="line"><span class="keyword">if</span> i == <span class="number">0</span> &#123;</span><br><span class="line">arr[i]= <span class="number">100</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(arr[i])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">"\n"</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="qie-pian-slice">切片: slice</span><a href="#qie-pian-slice" class="header-anchor"></a></h3><ul><li>simpleSliceTest.go</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">Go 语言很重要部分: Slice</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">1. slice 扩展</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">2. 向slice添加元素</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">arr := [...]<span class="keyword">int</span>&#123;<span class="number">2</span>, <span class="number">23</span>, <span class="number">392</span>, <span class="number">22</span>, <span class="number">9</span>, <span class="number">4</span>&#125;</span><br><span class="line"><span class="comment">//半开半闭区间操作:</span></span><br><span class="line"><span class="comment">//arr[2:5]  --&gt; arr[2] ... arr[4]</span></span><br><span class="line"><span class="comment">//故结果: [392 22 9]</span></span><br><span class="line">fmt.Println(arr[<span class="number">2</span>:<span class="number">5</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s1:=arr[<span class="number">2</span>:]</span><br><span class="line">fmt.Println(s1)</span><br><span class="line">updateArr(s1)</span><br><span class="line">fmt.Println(s1)</span><br><span class="line"></span><br><span class="line">s2:=arr[:]</span><br><span class="line">fmt.Println(s2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">打印:</span></span><br><span class="line"><span class="comment">[392 22 9]</span></span><br><span class="line"><span class="comment">[392 22 9 4]</span></span><br><span class="line"><span class="comment">[99 22 9 4]</span></span><br><span class="line"><span class="comment">[2 23 99 22 9 4]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//slice 扩展</span></span><br><span class="line"><span class="keyword">var</span> sa = []<span class="keyword">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>,&#125;</span><br><span class="line">fmt.Println(sa)</span><br><span class="line">ss1:=sa[<span class="number">2</span>:<span class="number">6</span>]</span><br><span class="line">ss2:=ss1[<span class="number">3</span>:<span class="number">5</span>]</span><br><span class="line">fmt.Println(<span class="string">"ss1  :  "</span>,ss1)</span><br><span class="line">fmt.Println(<span class="string">"ss2  :  "</span>,ss2)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">[0 1 2 3 4 5 6 7]</span></span><br><span class="line"><span class="comment">ss1  :   [2 3 4 5]</span></span><br><span class="line"><span class="comment">ss2  :   [5 6]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">slice 可以向后扩展 不可以向前扩展</span></span><br><span class="line"><span class="comment">s[i] 不可以超越len(s),向后扩展不可以超越底层数组 cap(s)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//打印相应的 caps</span></span><br><span class="line">fmt.Printf(<span class="string">"ss1 = %v, len(ss1) = %d , cap(ss1) = %d \n"</span>,ss1,<span class="built_in">len</span>(ss1),<span class="built_in">cap</span>(ss1))</span><br><span class="line">fmt.Printf(<span class="string">"ss2 = %v, len(ss2) = %d , cap(ss2) = %d \n"</span>,ss2,<span class="built_in">len</span>(ss2),<span class="built_in">cap</span>(ss2))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">ss1 = [2 3 4 5], len(ss1) = 4 , cap(ss1) = 6</span></span><br><span class="line"><span class="comment">ss2 = [5 6], len(ss2) = 2 , cap(ss2) = 3</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">updateArr</span><span class="params">(arr []<span class="keyword">int</span>)</span></span>  &#123;</span><br><span class="line">arr[<span class="number">0</span>]= <span class="number">99</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>doSlice.go</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">操作 slice:</span></span><br><span class="line"><span class="comment">1. append 添加元素</span></span><br><span class="line"><span class="comment">2. copy slice</span></span><br><span class="line"><span class="comment">3. delete one element from slice</span></span><br><span class="line"><span class="comment">4. remove from head and tail</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr []<span class="keyword">int</span></span><br><span class="line">PrintSlice(arr)</span><br><span class="line"><span class="comment">//arr = [], len(arr) = 0 , cap(arr) = 0</span></span><br><span class="line">fmt.Println(<span class="string">"append element"</span>)</span><br><span class="line">arr =<span class="built_in">append</span>(arr, <span class="number">10</span>,<span class="number">20</span>, <span class="number">30</span>)</span><br><span class="line">PrintSlice(arr)</span><br><span class="line"><span class="comment">// arr = [10 20 30], len(arr) = 3 , cap(arr) = 4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//手动的创建 slice</span></span><br><span class="line">arr1 :=<span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">16</span>)</span><br><span class="line">PrintSlice(arr1)</span><br><span class="line"><span class="comment">//arr = [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0], len(arr) = 16 , cap(arr) = 16</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">arr2 :=<span class="built_in">make</span>([]<span class="keyword">int</span>,<span class="number">16</span>, <span class="number">25</span>)</span><br><span class="line">PrintSlice(arr2)</span><br><span class="line"><span class="comment">//arr = [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0], len(arr) = 16 , cap(arr) = 25</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">"copy slice"</span>)</span><br><span class="line"><span class="built_in">copy</span>(arr1, arr)</span><br><span class="line">PrintSlice(arr1)</span><br><span class="line"><span class="comment">//arr = [10 20 30 0 0 0 0 0 0 0 0 0 0 0 0 0], len(arr) = 16 , cap(arr) = 16</span></span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">"delete one element from slice"</span>)</span><br><span class="line"><span class="comment">//删掉上面的30元素,index =2</span></span><br><span class="line">arr1=<span class="built_in">append</span>(arr1[:<span class="number">2</span>],arr1[<span class="number">3</span>:]...)</span><br><span class="line">PrintSlice(arr1)</span><br><span class="line"><span class="comment">//arr = [10 20 0 0 0 0 0 0 0 0 0 0 0 0 0], len(arr) = 15 , cap(arr) = 16</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">"remove from head and tail"</span>)</span><br><span class="line">arr1=arr1[<span class="number">1</span>:]</span><br><span class="line">PrintSlice(arr1)</span><br><span class="line"><span class="comment">//arr = [20 0 0 0 0 0 0 0 0 0 0 0 0 0], len(arr) = 14 , cap(arr) = 15</span></span><br><span class="line">arr1=arr1[:<span class="built_in">len</span>(arr1)<span class="number">-1</span>]</span><br><span class="line">PrintSlice(arr1)</span><br><span class="line"><span class="comment">//arr = [20 0 0 0 0 0 0 0 0 0 0 0 0], len(arr) = 13 , cap(arr) = 15</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">PrintSlice</span><span class="params">(arr []<span class="keyword">int</span>)</span></span>  &#123;</span><br><span class="line">fmt.Printf(<span class="string">"arr = %v, len(arr) = %d , cap(arr) = %d \n"</span>,arr,<span class="built_in">len</span>(arr),<span class="built_in">cap</span>(arr))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="map">Map</span><a href="#map" class="header-anchor"></a></h3><ul><li>DoGoMap.go</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">Map :</span></span><br><span class="line"><span class="comment">1.创建方式: 这个是 HashMap 类型</span></span><br><span class="line"><span class="comment">m:=map[string]string&#123;&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">m:=make(map[string]int)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">2.获取元素</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">3.判断元素是否存在 if</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">4.删除某个元素</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">5.range 遍历</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">6.key 类型:</span></span><br><span class="line"><span class="comment">      除了 slice map function 内建类型都可以作为 key</span></span><br><span class="line"><span class="comment">      struct类型不包含上述字段，也可以作为 key</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建 map</span></span><br><span class="line">m:=<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加元素</span></span><br><span class="line">m[<span class="string">"lai"</span>]= <span class="string">"Lai"</span></span><br><span class="line">m[<span class="string">"hao"</span>]= <span class="string">"Hao"</span></span><br><span class="line">m[<span class="string">"da"</span>]= <span class="string">"Da"</span></span><br><span class="line"></span><br><span class="line">PrintMap(m)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">lai Lai</span></span><br><span class="line"><span class="comment">hao Hao</span></span><br><span class="line"><span class="comment">da Da</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//删除元素</span></span><br><span class="line"><span class="built_in">delete</span>(m, <span class="string">"lai"</span>)</span><br><span class="line">PrintMap(m)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">hao Hao</span></span><br><span class="line"><span class="comment">da Da</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//修改元素</span></span><br><span class="line">m[<span class="string">"hao"</span>]= <span class="string">"HAhahaha.."</span></span><br><span class="line">PrintMap(m)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">hao HAhahaha..</span></span><br><span class="line"><span class="comment">da Da</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//判断元素是否存在</span></span><br><span class="line">key,ok:=m[<span class="string">"da"</span>]</span><br><span class="line">fmt.Println(key, ok)</span><br><span class="line"><span class="comment">// Da true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> key,ok:=m[<span class="string">"da"</span>]; ok &#123;</span><br><span class="line">fmt.Println(<span class="string">"存在此 key  "</span>,key)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">"don't have key %s  exist"</span>, key)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//存在此 key   Da</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">PrintMap</span><span class="params">(m <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span></span>  &#123;</span><br><span class="line"><span class="keyword">for</span> k,v :=<span class="keyword">range</span> m &#123;</span><br><span class="line">fmt.Println(k,v)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Go 数组,切片,Map
    
    </summary>
    
    
      <category term="Go" scheme="https://zuoyoulai.github.io/categories/Go/"/>
    
    
      <category term="Go" scheme="https://zuoyoulai.github.io/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>每天学习一个 Linux 指令 1  scp</title>
    <link href="https://zuoyoulai.github.io/2020/01/01/Linux-scp/"/>
    <id>https://zuoyoulai.github.io/2020/01/01/Linux-scp/</id>
    <published>2020-01-01T02:55:57.000Z</published>
    <updated>2020-01-01T05:04:29.917Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="mei-tian-xue-xi-yi-ge-linux-zhi-ling-1-scp">每天学习一个 Linux 指令 1 : scp</span><a href="#mei-tian-xue-xi-yi-ge-linux-zhi-ling-1-scp" class="header-anchor"></a></h2><div class="toc"><!-- toc --><ul><li><a href="#shuo-ming">说明</a></li><li><a href="#ming-ling-ge-shi">命令格式</a><ul><li><a href="#escape-figure-class-highlight-plain-table-tr-td-class-gutter-pre-span-class-line-1-span-br-span-class-line-2-span-br-pre-td-td-class-code-pre-span-class-line-span-br-span-class-line-scp-can-shu-yuan-lu-jing-mu-biao-lu-jing-span-br-pre-td-tr-table-figure-escape"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">scp [参数] [源路径] [目标路径]</span><br></pre></td></tr></table></figure></a></li></ul></li><li><a href="#ming-ling-can-shu">命令参数</a><ul><li><a href="#shi-li">实例</a></li></ul></li><li><a href="#fu-zhi-wen-jian">复制文件</a></li><li><a href="#fu-zhi-mu-lu">复制目录</a><ul><li><a href="#escape-figure-class-highlight-plain-table-tr-td-class-gutter-pre-span-class-line-1-span-br-span-class-line-2-span-br-span-class-line-3-span-br-pre-td-td-class-code-pre-span-class-line-span-br-span-class-line-scp-r-local-folder-remote-username-remote-ip-remote-folder-zhi-ding-liao-yong-hu-ming-ming-ling-zhi-xing-hou-xu-yao-shu-ru-yong-hu-mi-ma-span-br-span-class-line-scp-r-local-folder-remote-ip-remote-folder-mei-you-zhi-ding-yong-hu-ming-ming-ling-zhi-xing-hou-xu-yao-shu-ru-yong-hu-ming-he-mi-ma-span-br-pre-td-tr-table-figure-escape"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">scp -r local_folder remote_username@remote_ip:remote_folder  :  指定了用户名，命令执行后需要输入用户密码 </span><br><span class="line">scp -r local_folder remote_ip:remote_folder   :    没有指定用户名，命令执行后需要输入用户名和密码</span><br></pre></td></tr></table></figure></a></li></ul></li><li><a href="#cong-yuan-cheng-fu-wu-qi-fu-zhi-dao-ben-di-fu-wu-qi">从远程服务器复制到本地服务器</a><ul><li><a href="#escape-figure-class-highlight-plain-table-tr-td-class-gutter-pre-span-class-line-1-span-br-span-class-line-2-span-br-pre-td-td-class-code-pre-span-class-line-span-br-span-class-line-cong-yuan-cheng-fu-zhi-dao-ben-di-de-scp-ming-ling-yu-shang-mian-de-ming-ling-lei-tong-zhi-yao-jiang-cong-ben-di-fu-zhi-dao-yuan-cheng-de-ming-ling-hou-mian-2-ge-can-shu-hu-huan-shun-xu-jiu-xing-liao-span-br-pre-td-tr-table-figure-escape"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">从远程复制到本地的scp命令与上面的命令雷同，只要将从本地复制到远程的命令后面2个参数互换顺序就行了。</span><br></pre></td></tr></table></figure></a></li></ul></li><li><a href="#li-zi-1-cong-yuan-chu-fu-zhi-wen-jian-dao-ben-di-mu-lu">例子 1 :  从远处复制文件到本地目录</a><ul><li><a href="#escape-figure-class-highlight-plain-table-tr-td-class-gutter-pre-span-class-line-1-span-br-span-class-line-2-span-br-span-class-line-3-span-br-span-class-line-4-span-br-pre-td-td-class-code-pre-span-class-line-span-br-span-class-line-scp-root-192-168-120-204-x2f-opt-x2f-soft-x2f-nginx-0-5-38-tar-gz-x2f-opt-x2f-soft-x2f-span-br-span-class-line-span-br-span-class-line-cong-192-168-120-204-ji-qi-shang-de-x2f-opt-x2f-soft-x2f-de-mu-lu-zhong-xia-zai-nginx-0-5-38-tar-gz-wen-jian-dao-ben-di-x2f-opt-x2f-soft-x2f-mu-lu-zhong-span-br-pre-td-tr-table-figure-escape"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">scp root@192.168.120.204:&#x2F;opt&#x2F;soft&#x2F;nginx-0.5.38.tar.gz &#x2F;opt&#x2F;soft&#x2F;</span><br><span class="line"></span><br><span class="line">从192.168.120.204机器上的&#x2F;opt&#x2F;soft&#x2F;的目录中下载nginx-0.5.38.tar.gz 文件到本地&#x2F;opt&#x2F;soft&#x2F;目录中</span><br></pre></td></tr></table></figure></a></li></ul></li><li><a href="#li-zi-2-cong-yuan-chu-fu-zhi-dao-ben-di">例子 2 :  从远处复制到本地</a></li><li><a href="#li-zi-3-shang-chuan-ben-di-wen-jian-dao-yuan-cheng-ji-qi-zhi-ding-mu-lu">例子 3 :  上传本地文件到远程机器指定目录</a></li><li><a href="#li-zi-4-shang-chuan-ben-di-mu-lu-dao-yuan-cheng-ji-qi-zhi-ding-mu-lu">例子 4 :  上传本地目录到远程机器指定目录</a></li><li><a href="#li-zi-5-cong-yuan-chu-mu-lu-dao-ben-di-zhi-ding-mu-lu-ssh-key">例子 5 :  从远处目录到本地指定目录 + ssh key</a><ul><li><a href="#escape-figure-class-highlight-plain-table-tr-td-class-gutter-pre-span-class-line-1-span-br-span-class-line-2-span-br-span-class-line-3-span-br-span-class-line-4-span-br-span-class-line-5-span-br-span-class-line-6-span-br-span-class-line-7-span-br-span-class-line-8-span-br-span-class-line-9-span-br-span-class-line-10-span-br-span-class-line-11-span-br-span-class-line-12-span-br-span-class-line-13-span-br-span-class-line-14-span-br-span-class-line-15-span-br-span-class-line-16-span-br-span-class-line-17-span-br-span-class-line-18-span-br-span-class-line-19-span-br-span-class-line-20-span-br-span-class-line-21-span-br-span-class-line-22-span-br-span-class-line-23-span-br-span-class-line-24-span-br-pre-td-td-class-code-pre-span-class-line-span-br-span-class-line-span-br-span-class-line-a-ji-qi-wu-mi-deng-lu-b-ji-qi-de-cao-zuo-ssh-root-ipaddress-span-br-span-class-line-span-br-span-class-line-2-tai-ji-qi-a-ben-di-b-yuan-cheng-span-br-span-class-line-span-br-span-class-line-in-a-ji-qi-span-br-span-class-line-1-yum-install-ssh-span-br-span-class-line-2-ssh-keygen-t-rsa-c-quot-472023527-qq-com-quot-span-br-span-class-line-3-cat-x2f-ssh-x2f-id-rsa-pub-x2f-x2f-id-rsa-shi-si-yao-span-br-span-class-line-span-br-span-class-line-jiang-zhe-ge-gong-yao-gei-ji-qi-b-zhong-span-br-span-class-line-span-br-span-class-line-span-br-span-class-line-in-b-ji-qi-span-br-span-class-line-jin-ru-x2f-root-x2f-ssh-x2f-mu-lu-zhong-jiang-a-ji-qi-de-gong-yao-gei-fu-zhi-dao-b-qi-wen-jian-sam-pub-span-br-span-class-line-ran-hou-zhi-xing-zhi-ling-span-br-span-class-line-span-br-span-class-line-gt-gt-cat-sam-pub-gt-gt-x2f-root-x2f-ssh-x2f-authorized-keys-jiang-id-rsa-pub-de-nei-rong-zhui-jia-dao-authorized-keys-zhong-span-br-span-class-line-span-br-span-class-line-span-br-span-class-line-jie-xia-lai-jiu-ke-yi-zhi-xing-scp-de-cao-zuo-liao-span-br-span-class-line-span-br-span-class-line-scp-r-root-192-168-120-204-x2f-opt-x2f-soft-x2f-mongodb-x2f-opt-x2f-soft-x2f-span-br-pre-td-tr-table-figure-escape"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">A机器无密登录 B 机器的操作: ssh root@ipAddress</span><br><span class="line"></span><br><span class="line">2台机器 A 本地   B 远程:</span><br><span class="line"></span><br><span class="line">In A机器：</span><br><span class="line">1.yum install ssh</span><br><span class="line">2.ssh-keygen -t rsa -C &quot;472023527@qq.com&quot;</span><br><span class="line">3.cat ~&#x2F;.ssh&#x2F;id_rsa.pub    &#x2F;&#x2F; id_rsa是私钥</span><br><span class="line"></span><br><span class="line">将这个公钥给机器 B 中</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">In B机器:</span><br><span class="line">进入&#x2F;root&#x2F;.ssh&#x2F;目录中 将 A 机器的公钥给复制到 B 器文件 : sam.pub</span><br><span class="line">然后执行指令:</span><br><span class="line"></span><br><span class="line">&gt;&gt; cat sam.pub &gt;&gt; &#x2F;root&#x2F;.ssh&#x2F;authorized_keys (将id_rsa.pub的内容追加到authorized_keys 中)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">接下来就可以执行 scp 的操作了:</span><br><span class="line"></span><br><span class="line">scp -r root@192.168.120.204:&#x2F;opt&#x2F;soft&#x2F;mongodb &#x2F;opt&#x2F;soft&#x2F;</span><br></pre></td></tr></table></figure></a></li><li><a href="#can-kao-wen-zhang">参考文章</a></li></ul></li></ul><!-- tocstop --></div><h3><span id="shuo-ming">说明</span><a href="#shuo-ming" class="header-anchor"></a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">scp是secure copy的简写，用于在Linux下进行远程拷贝文件的命令，和它类似的命令有cp，</span><br><span class="line">不过cp只是在本机进行拷贝不能跨服务器，而且scp传输是加密的。可能会稍微影响一下速度。当你服务器硬盘变</span><br><span class="line">为只读 read only system时，用scp可以帮你把文件移出来。另外，scp还非常不占资源，不会提高多少系统</span><br><span class="line">负荷，在这一点上，rsync就远远不及它了。虽然 rsync比scp会快一点，但当小文件众多的情况下，rsync会</span><br><span class="line">导致硬盘I&#x2F;O非常高，而scp基本不影响系统正常使用。</span><br><span class="line"></span><br><span class="line">scp是linux系统下基于ssh登陆进行安全的远程文件拷贝命令。linux的scp命令可以在linux服务器之间复制文件和目录。</span><br></pre></td></tr></table></figure><hr><h3><span id="ming-ling-ge-shi">命令格式</span><a href="#ming-ling-ge-shi" class="header-anchor"></a></h3><ul><li>格式:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">scp [参数] [源路径] [目标路径]</span><br></pre></td></tr></table></figure><hr><h3><span id="ming-ling-can-shu">命令参数</span><a href="#ming-ling-can-shu" class="header-anchor"></a></h3><ul><li>参数:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">scp [参数] [源路径] [目标路径]</span><br><span class="line"></span><br><span class="line">这里的参数:</span><br><span class="line"></span><br><span class="line">-1  强制scp命令使用协议ssh1  </span><br><span class="line"></span><br><span class="line">-2  强制scp命令使用协议ssh2  </span><br><span class="line"></span><br><span class="line">-4  强制scp命令只使用IPv4寻址  </span><br><span class="line"></span><br><span class="line">-6  强制scp命令只使用IPv6寻址  </span><br><span class="line"></span><br><span class="line">-B  使用批处理模式（传输过程中不询问传输口令或短语）  </span><br><span class="line"></span><br><span class="line">-C  允许压缩。（将-C标志传递给ssh，从而打开压缩功能）  </span><br><span class="line"></span><br><span class="line">-p 保留原文件的修改时间，访问时间和访问权限。  </span><br><span class="line"></span><br><span class="line">-q  不显示传输进度条。  </span><br><span class="line"></span><br><span class="line">-r  递归复制整个目录。  </span><br><span class="line"></span><br><span class="line">-v 详细方式显示输出。scp和ssh(1)会显示出整个过程的调试信息。这些信息用于调试连接，验证和配置问题。   </span><br><span class="line"></span><br><span class="line">-c cipher  以cipher将数据传输进行加密，这个选项将直接传递给ssh。   </span><br><span class="line"></span><br><span class="line">-F ssh_config  指定一个替代的ssh配置文件，此参数直接传递给ssh。  </span><br><span class="line"></span><br><span class="line">-i identity_file  从指定文件中读取传输时使用的密钥文件，此参数直接传递给ssh。    </span><br><span class="line"></span><br><span class="line">-l limit  限定用户所能使用的带宽，以Kbit&#x2F;s为单位。     </span><br><span class="line"></span><br><span class="line">-o ssh_option  如果习惯于使用ssh_config(5)中的参数传递方式，   </span><br><span class="line"></span><br><span class="line">-P port  注意是大写的P, port是指定数据传输用到的端口号   </span><br><span class="line"></span><br><span class="line">-S program  指定加密传输时所使用的程序。此程序必须能够理解ssh(1)的选项。</span><br></pre></td></tr></table></figure></li></ul><hr><h2><span id="shi-li">实例</span><a href="#shi-li" class="header-anchor"></a></h2><h3><span id="fu-zhi-wen-jian">复制文件</span><a href="#fu-zhi-wen-jian" class="header-anchor"></a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">命令执行后需要输入用户密码，第1个仅指定了远程的目录，文件名字不变，第2个指定了文件名:</span><br><span class="line">1. scp local_file remote_username@remote_ip:remote_folder</span><br><span class="line">2. scp local_file remote_username@remote_ip:remote_file</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">第3,4个没有指定用户名，命令执行后需要输入用户名和密码，第3个仅指定了远程的目录，文件名字不变，第4个指定了文件名</span><br><span class="line">3. scp local_file remote_ip:remote_folder  </span><br><span class="line">4. scp local_file remote_ip:remote_file</span><br></pre></td></tr></table></figure><hr><h3><span id="fu-zhi-mu-lu">复制目录</span><a href="#fu-zhi-mu-lu" class="header-anchor"></a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">scp -r local_folder remote_username@remote_ip:remote_folder  :  指定了用户名，命令执行后需要输入用户密码 </span><br><span class="line">scp -r local_folder remote_ip:remote_folder   :    没有指定用户名，命令执行后需要输入用户名和密码</span><br></pre></td></tr></table></figure><hr><h3><span id="cong-yuan-cheng-fu-wu-qi-fu-zhi-dao-ben-di-fu-wu-qi">从远程服务器复制到本地服务器</span><a href="#cong-yuan-cheng-fu-wu-qi-fu-zhi-dao-ben-di-fu-wu-qi" class="header-anchor"></a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">从远程复制到本地的scp命令与上面的命令雷同，只要将从本地复制到远程的命令后面2个参数互换顺序就行了。</span><br></pre></td></tr></table></figure><hr><h3><span id="li-zi-1-cong-yuan-chu-fu-zhi-wen-jian-dao-ben-di-mu-lu">例子 1 :  从远处复制文件到本地目录</span><a href="#li-zi-1-cong-yuan-chu-fu-zhi-wen-jian-dao-ben-di-mu-lu" class="header-anchor"></a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">scp root@192.168.120.204:&#x2F;opt&#x2F;soft&#x2F;nginx-0.5.38.tar.gz &#x2F;opt&#x2F;soft&#x2F;</span><br><span class="line"></span><br><span class="line">从192.168.120.204机器上的&#x2F;opt&#x2F;soft&#x2F;的目录中下载nginx-0.5.38.tar.gz 文件到本地&#x2F;opt&#x2F;soft&#x2F;目录中</span><br></pre></td></tr></table></figure><hr><h3><span id="li-zi-2-cong-yuan-chu-fu-zhi-dao-ben-di">例子 2 :  从远处复制到本地</span><a href="#li-zi-2-cong-yuan-chu-fu-zhi-dao-ben-di" class="header-anchor"></a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">scp -r root@192.168.120.204:&#x2F;opt&#x2F;soft&#x2F;mongodb &#x2F;opt&#x2F;soft&#x2F;</span><br><span class="line"></span><br><span class="line">从192.168.120.204机器上的&#x2F;opt&#x2F;soft&#x2F;中下载mongodb 目录到本地的&#x2F;opt&#x2F;soft&#x2F;目录来。</span><br></pre></td></tr></table></figure><hr><h3><span id="li-zi-3-shang-chuan-ben-di-wen-jian-dao-yuan-cheng-ji-qi-zhi-ding-mu-lu">例子 3 :  上传本地文件到远程机器指定目录</span><a href="#li-zi-3-shang-chuan-ben-di-wen-jian-dao-yuan-cheng-ji-qi-zhi-ding-mu-lu" class="header-anchor"></a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">scp &#x2F;opt&#x2F;soft&#x2F;nginx-0.5.38.tar.gz root@192.168.120.204:&#x2F;opt&#x2F;soft&#x2F;scptest</span><br><span class="line"></span><br><span class="line">复制本地opt&#x2F;soft&#x2F;目录下的文件nginx-0.5.38.tar.gz 到远程机器192.168.120.204的opt&#x2F;soft&#x2F;scptest目录</span><br></pre></td></tr></table></figure><hr><h3><span id="li-zi-4-shang-chuan-ben-di-mu-lu-dao-yuan-cheng-ji-qi-zhi-ding-mu-lu">例子 4 :  上传本地目录到远程机器指定目录</span><a href="#li-zi-4-shang-chuan-ben-di-mu-lu-dao-yuan-cheng-ji-qi-zhi-ding-mu-lu" class="header-anchor"></a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">scp -r &#x2F;opt&#x2F;soft&#x2F;mongodb root@192.168.120.204:&#x2F;opt&#x2F;soft&#x2F;scptes</span><br><span class="line"></span><br><span class="line">上传本地目录 &#x2F;opt&#x2F;soft&#x2F;mongodb到远程机器192.168.120.204上&#x2F;opt&#x2F;soft&#x2F;scptest的目录中去</span><br></pre></td></tr></table></figure><hr><h3><span id="li-zi-5-cong-yuan-chu-mu-lu-dao-ben-di-zhi-ding-mu-lu-ssh-key">例子 5 :  从远处目录到本地指定目录 + ssh key</span><a href="#li-zi-5-cong-yuan-chu-mu-lu-dao-ben-di-zhi-ding-mu-lu-ssh-key" class="header-anchor"></a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">A机器无密登录 B 机器的操作: ssh root@ipAddress</span><br><span class="line"></span><br><span class="line">2台机器 A 本地   B 远程:</span><br><span class="line"></span><br><span class="line">In A机器：</span><br><span class="line">1.yum install ssh</span><br><span class="line">2.ssh-keygen -t rsa -C &quot;472023527@qq.com&quot;</span><br><span class="line">3.cat ~&#x2F;.ssh&#x2F;id_rsa.pub    &#x2F;&#x2F; id_rsa是私钥</span><br><span class="line"></span><br><span class="line">将这个公钥给机器 B 中</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">In B机器:</span><br><span class="line">进入&#x2F;root&#x2F;.ssh&#x2F;目录中 将 A 机器的公钥给复制到 B 器文件 : sam.pub</span><br><span class="line">然后执行指令:</span><br><span class="line"></span><br><span class="line">&gt;&gt; cat sam.pub &gt;&gt; &#x2F;root&#x2F;.ssh&#x2F;authorized_keys (将id_rsa.pub的内容追加到authorized_keys 中)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">接下来就可以执行 scp 的操作了:</span><br><span class="line"></span><br><span class="line">scp -r root@192.168.120.204:&#x2F;opt&#x2F;soft&#x2F;mongodb &#x2F;opt&#x2F;soft&#x2F;</span><br></pre></td></tr></table></figure><hr><h2><span id="can-kao-wen-zhang">参考文章</span><a href="#can-kao-wen-zhang" class="header-anchor"></a></h2><ul><li>来自 : <a href="https://www.cnblogs.com/peida/archive/2013/03/15/2960802.html" target="_blank" rel="noopener">https://www.cnblogs.com/peida/archive/2013/03/15/2960802.html</a></li><li>ssh无秘登录的操作 : <a href="https://blog.csdn.net/lizhiyuan_eagle/article/details/80494512" target="_blank" rel="noopener">https://blog.csdn.net/lizhiyuan_eagle/article/details/80494512</a></li></ul>]]></content>
    
    <summary type="html">
    
      每天学习一个 Linux 指令  scp
    
    </summary>
    
    
      <category term="Linux" scheme="https://zuoyoulai.github.io/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://zuoyoulai.github.io/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Git使用内容</title>
    <link href="https://zuoyoulai.github.io/2019/12/31/Git-md/"/>
    <id>https://zuoyoulai.github.io/2019/12/31/Git-md/</id>
    <published>2019-12-31T09:17:19.000Z</published>
    <updated>2019-12-31T09:55:29.769Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="git-shi-yong">Git 使用</span><a href="#git-shi-yong" class="header-anchor"></a></h2><div class="toc"><!-- toc --><ul><li><a href="#tian-jia-yong-hu-ji-ben-xin-xi">添加用户基本信息</a></li><li><a href="#shan-diao-ben-di-or-yuan-cheng-fen-zhi">删掉本地 Or 远程分支</a></li><li><a href="#ben-di-sheng-cheng-key-xie-ru-github-zhong-sshkey-fang-bian-ti-jiao-dai-ma">本地生成 key 写入 GitHub 中 sshkey 方便提交代码</a></li><li><a href="#cherry-pick-zhi-geng-xin-mou-ge-commit-de-li-mian-nei-rong">cherry-pick : 只更新某个 commit 的里面内容</a></li><li><a href="#hui-gun-dao-zhi-qian-mou-ge-fen-zhi">回滚到之前某个分支</a></li><li><a href="#qiang-xing-fu-gai-de-zui-xin-de-nei-rong">强行覆盖的最新的内容</a></li><li><a href="#bei-fen-xiang-mu-xiang-mu-tong-shi-tui-song-dao-githhub-yu-coding">备份项目 :  项目同时推送到githhub与coding</a></li></ul><!-- tocstop --></div><h3><span id="tian-jia-yong-hu-ji-ben-xin-xi">添加用户基本信息</span><a href="#tian-jia-yong-hu-ji-ben-xin-xi" class="header-anchor"></a></h3><ul><li>可以让本地提交的内容有相应的用户,这样就看 git log 的时候则会出现什么用户提交过了,而不是某个邮箱地址内容提交</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">git config --global user.name &quot;xxxx@qq.com&quot;</span><br><span class="line">git config --global user.email &quot;xxx@qq.com&quot;</span><br></pre></td></tr></table></figure><hr><h3><span id="shan-diao-ben-di-or-yuan-cheng-fen-zhi">删掉本地 Or 远程分支</span><a href="#shan-diao-ben-di-or-yuan-cheng-fen-zhi" class="header-anchor"></a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">删除分支：git branch -d &lt;name&gt;</span><br><span class="line"></span><br><span class="line">删除远程分支：git push origin --delete &lt;name&gt;</span><br></pre></td></tr></table></figure><hr><h3><span id="ben-di-sheng-cheng-key-xie-ru-github-zhong-sshkey-fang-bian-ti-jiao-dai-ma">本地生成 key 写入 GitHub 中 sshkey 方便提交代码</span><a href="#ben-di-sheng-cheng-key-xie-ru-github-zhong-sshkey-fang-bian-ti-jiao-dai-ma" class="header-anchor"></a></h3><ul><li>github添加一个ssh key</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Linux:</span><br><span class="line"></span><br><span class="line">1.yum install ssh</span><br><span class="line">2.ssh-keygen -t rsa -C &quot;472023527@qq.com&quot;</span><br><span class="line">3.cat ~&#x2F;.ssh&#x2F;id_rsa.pub  [复制粘贴到github头像那边的setting再进行添加相应的key值]</span><br><span class="line">4.以后进行git操作的代码的时候则不是git https:&#x2F;&#x2F;xxx的方式</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Windows:</span><br><span class="line"></span><br><span class="line">1. 安装git，桌面右键点击 &quot;Git Bash&quot;</span><br><span class="line">2. cd ~&#x2F;.ssh&#x2F; </span><br><span class="line">3. vi id_rsa.pub  如有 复制内容，在github.com的网站上到ssh密钥管理页面，添加新公钥</span><br><span class="line">4. 如没有自行创建公钥</span><br></pre></td></tr></table></figure><hr><h3><span id="cherry-pick-zhi-geng-xin-mou-ge-commit-de-li-mian-nei-rong">cherry-pick : 只更新某个 commit 的里面内容</span><a href="#cherry-pick-zhi-geng-xin-mou-ge-commit-de-li-mian-nei-rong" class="header-anchor"></a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">将A分支的一个commit合并到B分支：</span><br><span class="line"> </span><br><span class="line">首先切换到A分支</span><br><span class="line"> </span><br><span class="line">git checkout A</span><br><span class="line"> </span><br><span class="line">git log</span><br><span class="line"> </span><br><span class="line">找出要合并的commit ID :</span><br><span class="line"> </span><br><span class="line">例如</span><br><span class="line"> </span><br><span class="line">xxx001</span><br><span class="line"> </span><br><span class="line">然后切换到B分支上</span><br><span class="line"> </span><br><span class="line">git checkout B</span><br><span class="line"> </span><br><span class="line">git cherry-pick  xxx001</span><br><span class="line"> </span><br><span class="line">然后就将A分支的某个commit合并到了B分支了</span><br></pre></td></tr></table></figure><hr><h3><span id="hui-gun-dao-zhi-qian-mou-ge-fen-zhi">回滚到之前某个分支</span><a href="#hui-gun-dao-zhi-qian-mou-ge-fen-zhi" class="header-anchor"></a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">查找对应Log的 id:</span><br><span class="line">git log -3</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">回滚到指定的版本:</span><br><span class="line">git reset --hard e377f60e28c8b84158</span><br><span class="line">git reset --hard 156d981</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">强制提交:</span><br><span class="line">git push -f origin master</span><br></pre></td></tr></table></figure><hr><h3><span id="qiang-xing-fu-gai-de-zui-xin-de-nei-rong">强行覆盖的最新的内容</span><a href="#qiang-xing-fu-gai-de-zui-xin-de-nei-rong" class="header-anchor"></a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">将一个分支覆盖相应的分支:</span><br><span class="line"> </span><br><span class="line">1.切换到test分支上 </span><br><span class="line">  git checkout test    </span><br><span class="line"> </span><br><span class="line">2.将master合并到test</span><br><span class="line">  git merge master</span><br><span class="line"> </span><br><span class="line">3.将master分支删掉</span><br><span class="line">  git branch -d master</span><br><span class="line"> </span><br><span class="line">4.将test分支覆盖到master分支上</span><br><span class="line">  git branch -m test master</span><br><span class="line"> </span><br><span class="line">5.将master分支推送远程库上[有分支则覆盖  无分支则创建新的分支并更新上去]</span><br><span class="line">  git push -f origin master</span><br></pre></td></tr></table></figure><hr><h3><span id="bei-fen-xiang-mu-xiang-mu-tong-shi-tui-song-dao-githhub-yu-coding">备份项目 :  项目同时推送到githhub与coding</span><a href="#bei-fen-xiang-mu-xiang-mu-tong-shi-tui-song-dao-githhub-yu-coding" class="header-anchor"></a></h3><ol><li>在 CODING 中新建一个同名项目，不选择 启用 README.md 文件初始化项目，以及任何 License 和 .gitignore 文件</li><li>在本地项目上添加一个:</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> git remote set-url --add origin https:&#x2F;&#x2F;git.coding.net&#x2F;samlai&#x2F;xxx.git</span><br><span class="line"></span><br><span class="line"> ps:项目的根目录.git文件夹下confi配置文件变成</span><br><span class="line">[remote &quot;origin&quot;]</span><br><span class="line">url &#x3D; https:&#x2F;&#x2F;github.com&#x2F;ZuoYouLai&#x2F;xxx.git</span><br><span class="line">fetch &#x3D; +refs&#x2F;heads&#x2F;*:refs&#x2F;remotes&#x2F;origin&#x2F;*</span><br><span class="line">url &#x3D; https:&#x2F;&#x2F;git.coding.net&#x2F;samlai&#x2F;xxx.git</span><br><span class="line">[branch &quot;master&quot;]</span><br><span class="line">remote &#x3D; origin</span><br><span class="line">merge &#x3D; refs&#x2F;heads&#x2F;master</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">指令辅助：</span><br><span class="line">    (git remote 看看现在项目git 远程主机情况)</span><br><span class="line">    git remote -v</span><br><span class="line">    (git remote add 添加一个远程主机)</span><br><span class="line">    git remote add xx xxx.git</span><br><span class="line">    (git remote rm xx  删掉远程某个远程的配置内容)</span><br></pre></td></tr></table></figure><ol start="3"><li>修改本地项目的任意一个文件:</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">git add .  </span><br><span class="line">git commit -m &#39;test&#39;</span><br><span class="line">git push origin master &#x2F;&#x2F; 把本地仓库的变化连接到远程仓库主分支</span><br></pre></td></tr></table></figure><ol start="4"><li>参考文章:</li></ol><ul><li><a href="https://feitianbenyue.iteye.com/blog/2376791" target="_blank" rel="noopener">https://feitianbenyue.iteye.com/blog/2376791</a>  </li><li><a href="https://coding.net/help/doc/git/import.html" target="_blank" rel="noopener">https://coding.net/help/doc/git/import.html</a></li></ul>]]></content>
    
    <summary type="html">
    
      Git 使用内容
    
    </summary>
    
    
      <category term="Git" scheme="https://zuoyoulai.github.io/categories/Git/"/>
    
    
      <category term="Git" scheme="https://zuoyoulai.github.io/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>Go 学习</title>
    <link href="https://zuoyoulai.github.io/2019/12/29/Go-Study/"/>
    <id>https://zuoyoulai.github.io/2019/12/29/Go-Study/</id>
    <published>2019-12-29T07:20:44.000Z</published>
    <updated>2020-01-07T15:11:08.053Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="go-yu-yan-xue-xi">GO 语言学习</span><a href="#go-yu-yan-xue-xi" class="header-anchor"></a></h2><div class="toc"><!-- toc --><ul><li><a href="#xue-xi">学习</a></li><li><a href="#an-zhuang">安装</a></li><li><a href="#zhi-ling-cao-zuo">指令操作</a></li><li><a href="#import-cao-zuo">Import 操作：</a></li><li><a href="#bian-liang-dai-ma">变量代码</a></li><li><a href="#chang-liang">常量</a></li><li><a href="#te-shu-chang-liang-iota-shi-yong">特殊常量 iota 使用</a><ul><li><a href="#bian-cheng">编程</a></li></ul></li><li><a href="#li-zi-1-http-helloworld">例子1 : Http:HelloWorld</a></li><li><a href="#li-zi-2-duo-xian-cheng-xian-cheng-jian-tong-xin">例子2 : 多线程 + 线程间通信</a></li><li><a href="#li-zi-3-shu-zu-de-nei-bu-pai-xu">例子3 : 数组的内部排序</a></li><li><a href="#li-zi-4-dan-yuan-ce-shi-cao-zuo">例子4 : 单元测试操作</a></li><li><a href="#li-zi-5-ji-zhun-ce-shi">例子5 : 基准测试</a></li></ul><!-- tocstop --></div><h3><span id="xue-xi">学习</span><a href="#xue-xi" class="header-anchor"></a></h3><ul><li>指令 : go tool tour</li><li>文档 : <a href="http://docscn.studygolang.com/doc/" target="_blank" rel="noopener">http://docscn.studygolang.com/doc/</a></li></ul><h3><span id="an-zhuang">安装</span><a href="#an-zhuang" class="header-anchor"></a></h3><ul><li><p>Linux</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">下载 &gt; 解压 &gt; 设置</span><br><span class="line"></span><br><span class="line">下载:</span><br><span class="line">    wget https:&#x2F;&#x2F;dl.google.com&#x2F;go&#x2F;go1.13.5.linux-amd64.tar.gz</span><br><span class="line">    </span><br><span class="line">解压:</span><br><span class="line">    tar -C &#x2F;usr&#x2F;local&#x2F; -xzf go1.13.5.linux-amd64.tar.gz</span><br><span class="line">    </span><br><span class="line">    &gt; cd &#x2F;usr&#x2F;local&#x2F;go</span><br><span class="line">    &gt; bin&#x2F;go version</span><br><span class="line">    &gt; go version go1.13.5 linux&#x2F;amd64    </span><br><span class="line">    </span><br><span class="line">设置:</span><br><span class="line">    &gt;&gt; vim &#x2F;etc&#x2F;profile</span><br><span class="line">    &gt;&gt; 添加到最后如下指令</span><br><span class="line">    #go path</span><br><span class="line">    GOROOT&#x3D;&#x2F;usr&#x2F;local&#x2F;go</span><br><span class="line">    export PATH&#x3D;$PATH:$GOROOT&#x2F;bin</span><br><span class="line">    &gt;&gt; 退出 wq ，执行: source %</span><br><span class="line">    &gt;&gt; go env  &#x2F;&#x2F;可以正常打印内容  说明安装成功</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">GOROOT</span><br><span class="line">GOPATH</span><br><span class="line">    Mac系统下</span><br><span class="line">GOBIN</span><br><span class="line">PATH</span><br></pre></td></tr></table></figure></li><li><p>Mac 设置 GoPath : <a href="https://www.jianshu.com/p/5c1873eaf3ca" target="_blank" rel="noopener">https://www.jianshu.com/p/5c1873eaf3ca</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"> 编辑~&#x2F;.bash_profile文件:</span><br><span class="line"> export GOROOT&#x3D;&#x2F;usr&#x2F;local&#x2F;go</span><br><span class="line"> </span><br><span class="line"> export GOPATH&#x3D;&#x2F;Users&#x2F;haodalai&#x2F;Desktop&#x2F;Go&#x2F;project</span><br><span class="line"> </span><br><span class="line"> export GOBIN&#x3D;</span><br><span class="line"> </span><br><span class="line"> export PATH&#x3D;$PATH:$&#123;GOPATH&#x2F;&#x2F;:&#x2F;&#x2F;bin:&#125;&#x2F;bin</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">退出执行:</span><br><span class="line">source ~&#x2F;.bash_profile </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Or</span><br><span class="line"></span><br><span class="line">编辑~&#x2F;.zshrc文件</span><br><span class="line"></span><br><span class="line">export GOROOT&#x3D;&#x2F;usr&#x2F;local&#x2F;go</span><br><span class="line"></span><br><span class="line">export GOPATH&#x3D;&#x2F;Users&#x2F;haodalai&#x2F;Desktop&#x2F;Go&#x2F;project</span><br><span class="line"></span><br><span class="line">export GOBIN&#x3D;</span><br><span class="line"></span><br><span class="line">export PATH&#x3D;$PATH:$&#123;GOPATH&#x2F;&#x2F;:&#x2F;&#x2F;bin:&#125;&#x2F;bin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">退出执行:</span><br><span class="line"></span><br><span class="line">source ~&#x2F;.zshrc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">最终执行:</span><br><span class="line">&gt;&gt; echo $GOPATH</span><br></pre></td></tr></table></figure></li><li><p>【注意: 以后开发的项目都放在$GOPATH 的 src 目录下】</p></li></ul><h4><span id="mac">Mac</span><a href="#mac" class="header-anchor"></a></h4><h4><span id="windows">Windows</span><a href="#windows" class="header-anchor"></a></h4><h3><span id="zhi-ling-cao-zuo">指令操作</span><a href="#zhi-ling-cao-zuo" class="header-anchor"></a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">go run </span><br><span class="line">   -v  列出被编译的代码包名称</span><br><span class="line">   -a  强制执行</span><br><span class="line">   -work 显示临时工作目录并不删除它</span><br><span class="line">   -x 打印命令 并执行过它的</span><br><span class="line">   -n 打印编译的命令但不执行他们</span><br><span class="line">   -p n: 并行编译 其中 n 为并行的数量</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">go build  编译源码文件或代码包  </span><br><span class="line"></span><br><span class="line">go install  编译并安装代码或者源码文件</span><br><span class="line">查看执行文件:</span><br><span class="line">ls $GOBIN  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">go get 从远程代码仓库上下载安装代码包</span><br><span class="line">下载到$GOPATH下 第一个文件的的 src文件夹中</span><br><span class="line">  -d 只执行下载动作不执行安装动作</span><br><span class="line">  -fix 下载后先执行修正动作 再进行编译安装</span><br><span class="line">  -U 利用网络来更新已有的代码包及其依赖包</span><br></pre></td></tr></table></figure><h3><span id="import-cao-zuo">Import 操作：</span><a href="#import-cao-zuo" class="header-anchor"></a></h3><ul><li>如果一个 main 导入其他包，包将被顺序导入</li><li>如果导入的包依赖其他包(包 B)，会首先导入 B 包，然后初始化 B 包中常量和变量，最后如果 B 包中有 init，会自动执行 init()</li><li>如果包导入完成后对 main 中常量和变量进行初始化，执行 main 中的 init函数</li><li>如果一个包被导入多次则该包只会被导入一次</li><li>import 别名 “.” “_”<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">别名：将导入的包命名为另一个容易记忆的别名</span><br><span class="line">点操作: .标识的包导入后，调用该包中函数时可以省略前缀包名</span><br><span class="line">下划线(_)操作: 导入该包，但不导入整个包，而是执行包中的 init 函数此无法通过包名来调用包中的其他函数</span><br><span class="line">             使用下划线操作往往为了注册包中的引擎，让外部可以方便地使用</span><br></pre></td></tr></table></figure></li></ul><h3><span id="bian-liang-dai-ma">变量代码</span><a href="#bian-liang-dai-ma" class="header-anchor"></a></h3><ul><li>全局变量需要加上 var  方法体内则可以不用加上</li><li>大写字母开头可以被包内其他文件导入，小写则不行</li></ul><h3><span id="chang-liang">常量</span><a href="#chang-liang" class="header-anchor"></a></h3><ul><li>类型：显示  隐式<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">显式：const identifier [type] &#x3D; value</span><br><span class="line">隐式：const identifier &#x3D; value (通常叫无类型常量)</span><br><span class="line">常量可以使用内置表达式定义 ： 例如 len() unsafe.Sizeof()</span><br><span class="line">常量范围目前只支持布尔，数字，字符串</span><br></pre></td></tr></table></figure></li></ul><h3><span id="te-shu-chang-liang-iota-shi-yong">特殊常量 iota 使用</span><a href="#te-shu-chang-liang-iota-shi-yong" class="header-anchor"></a></h3><ul><li>iota在 const 关键字出现时将被重置为0</li><li>const 中每新增一行常量声明将使 iota 计数一次</li><li>iota 常见用法<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 跳值使用法</span><br><span class="line">2. 插队使用法</span><br><span class="line">3. 表达式隐式使用法</span><br><span class="line">4. 单行使用法</span><br></pre></td></tr></table></figure></li></ul><h2><span id="bian-cheng">编程</span><a href="#bian-cheng" class="header-anchor"></a></h2><h3><span id="li-zi-1-http-helloworld">例子1  : Http:HelloWorld</span><a href="#li-zi-1-http-helloworld" class="header-anchor"></a></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">http.HandleFunc(<span class="string">"/"</span>, <span class="function"><span class="keyword">func</span><span class="params">(writer http.ResponseWriter, request *http.Request)</span></span> &#123;</span><br><span class="line">fmt.Fprint(writer,<span class="string">"Hello World! Mr.Sam赖"</span>)</span><br><span class="line">&#125;)</span><br><span class="line">http.ListenAndServe(<span class="string">":8989"</span>,<span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">访问： http:<span class="comment">//localhost:8989</span></span><br></pre></td></tr></table></figure><h3><span id="li-zi-2-duo-xian-cheng-xian-cheng-jian-tong-xin">例子2  : 多线程 + 线程间通信</span><a href="#li-zi-2-duo-xian-cheng-xian-cheng-jian-tong-xin" class="header-anchor"></a></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">ch :=<span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="number">10</span>;i++  &#123;</span><br><span class="line"><span class="keyword">go</span> hello(i, ch)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">msg :=&lt;-ch</span><br><span class="line">fmt.Print(msg)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(i <span class="keyword">int</span>,ch <span class="keyword">chan</span> <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span>  &#123;</span><br><span class="line">ch &lt;- fmt.Sprintf(<span class="string">"Hello World...%d \n "</span>, i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="li-zi-3-shu-zu-de-nei-bu-pai-xu">例子3 : 数组的内部排序</span><a href="#li-zi-3-shu-zu-de-nei-bu-pai-xu" class="header-anchor"></a></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"sort"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">//排序</span></span><br><span class="line">arr:=[]<span class="keyword">int</span>&#123;<span class="number">45</span>, <span class="number">23</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">905</span>, <span class="number">16</span>, <span class="number">75</span>&#125;</span><br><span class="line">sort.Ints(arr)</span><br><span class="line"><span class="keyword">for</span> _,val:=<span class="keyword">range</span> arr &#123;</span><br><span class="line">fmt.Println(val)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="li-zi-4-dan-yuan-ce-shi-cao-zuo">例子4 : 单元测试操作</span><a href="#li-zi-4-dan-yuan-ce-shi-cao-zuo" class="header-anchor"></a></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"testing"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">1.文件名称必须以: _test 作为后缀</span></span><br><span class="line"><span class="comment">2.忽略测试</span></span><br><span class="line"><span class="comment">  t.SkipNow()</span></span><br><span class="line"><span class="comment">3.执行指令: go test -v</span></span><br><span class="line"><span class="comment">4.注意点:</span></span><br><span class="line"><span class="comment">      方法名称一定需要 : Test_xxxx 名称 Test 为首字母大写</span></span><br><span class="line"><span class="comment">  方法体参数内容 : t *testing.T</span></span><br><span class="line"><span class="comment">5.日志显示: t.Log()  t.Error()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestRepeat</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">a :=repeat(<span class="string">"a"</span>)</span><br><span class="line">t.Log(<span class="string">"a 的值"</span>+ a)</span><br><span class="line">k := <span class="string">"aaaaa"</span></span><br><span class="line"><span class="keyword">if</span> a == k &#123;</span><br><span class="line">t.Logf(<span class="string">"测试成功,a 的值为 : %s"</span>,a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestPk</span><span class="params">(t *testing.T)</span></span>  &#123;</span><br><span class="line">t.Log( t.Name(),<span class="string">"开始执行 Pt 的内容"</span>)</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>;i&lt; <span class="number">9</span> ;i++  &#123;</span><br><span class="line">repeat(<span class="string">"a"</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">repeat</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">string</span></span>&#123;</span><br><span class="line"><span class="keyword">var</span> result <span class="keyword">string</span></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="number">5</span> ;i++  &#123;</span><br><span class="line">result+= <span class="string">"a"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAdd</span><span class="params">(t *testing.T)</span></span>  &#123;</span><br><span class="line"><span class="comment">//忽略测试</span></span><br><span class="line"><span class="comment">//t.SkipNow()</span></span><br><span class="line">t.Log(t.Name(), <span class="string">"Begin...."</span>)</span><br><span class="line">a := <span class="number">2</span></span><br><span class="line">b := <span class="number">3</span></span><br><span class="line"><span class="keyword">if</span> add(a,b) != <span class="number">5</span>&#123;</span><br><span class="line">t.Errorf(<span class="string">"result   %d "</span>,add(a, b))</span><br><span class="line">&#125;</span><br><span class="line">t.Logf(<span class="string">"a + b is  :  %d"</span>,add(a,b))</span><br><span class="line">t.Log(t.Name(), <span class="string">"end...."</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(a,b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> go test -v</span></span><br><span class="line"><span class="comment"> 打印结果：</span></span><br><span class="line"><span class="comment">=== RUN   TestRepeat</span></span><br><span class="line"><span class="comment">--- PASS: TestRepeat (0.00s)</span></span><br><span class="line"><span class="comment">    lx_test.go:18: a 的值aaaaa</span></span><br><span class="line"><span class="comment">    lx_test.go:21: 测试成功,a 的值为 : aaaaa</span></span><br><span class="line"><span class="comment">=== RUN   TestPk</span></span><br><span class="line"><span class="comment">--- PASS: TestPk (0.00s)</span></span><br><span class="line"><span class="comment">    lx_test.go:27: TestPk 开始执行 Pt 的内容</span></span><br><span class="line"><span class="comment">=== RUN   TestAdd</span></span><br><span class="line"><span class="comment">--- PASS: TestAdd (0.00s)</span></span><br><span class="line"><span class="comment">    lx_test.go:45: TestAdd Begin....</span></span><br><span class="line"><span class="comment">    lx_test.go:51: a + b is  :  5</span></span><br><span class="line"><span class="comment">    lx_test.go:52: TestAdd end....</span></span><br><span class="line"><span class="comment">PASS</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h3><span id="li-zi-5-ji-zhun-ce-shi">例子5 : 基准测试</span><a href="#li-zi-5-ji-zhun-ce-shi" class="header-anchor"></a></h3><ul><li>参考链接 ： <a href="http://c.biancheng.net/view/124.html" target="_blank" rel="noopener">http://c.biancheng.net/view/124.html</a><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">参考链接 : http://c.biancheng.net/view/124.html</span></span><br><span class="line"><span class="comment">基准测试:</span></span><br><span class="line"><span class="comment">1.一定需要方法名称 : Benchmark开头</span></span><br><span class="line"><span class="comment">2.执行的指令:</span></span><br><span class="line"><span class="comment">          go test -v -bench=.</span></span><br><span class="line"><span class="comment">          go test -v -bench=. jz_test.go</span></span><br><span class="line"><span class="comment">          增加自定义时间:</span></span><br><span class="line"><span class="comment">          go test -v -bench=. -benchtime=5s jz_test.go</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkAdd</span><span class="params">(b *testing.B)</span></span>  &#123;</span><br><span class="line"><span class="keyword">var</span> n <span class="keyword">int</span></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;b.N;i++ &#123;</span><br><span class="line">n++</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">执行:</span></span><br><span class="line"><span class="comment">go test -v -bench=.</span></span><br><span class="line"><span class="comment">打印的内容:</span></span><br><span class="line"><span class="comment">goos: darwin</span></span><br><span class="line"><span class="comment">goarch: amd64</span></span><br><span class="line"><span class="comment">BenchmarkAdd-16         1000000000               0.238 ns/op</span></span><br><span class="line"><span class="comment">PASS</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">测试说明：</span></span><br><span class="line"><span class="comment">执行了: 1000000000 次</span></span><br><span class="line"><span class="comment">每次的操作时间: 0.238 ns</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      学习新的语言，Go 语言
    
    </summary>
    
    
      <category term="Go" scheme="https://zuoyoulai.github.io/categories/Go/"/>
    
    
      <category term="Go" scheme="https://zuoyoulai.github.io/tags/Go/"/>
    
  </entry>
  
</feed>
